<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoinPrep Simulator - Crypto Portfolio Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2563eb;
            --primary-dark: #1e40af;
            --secondary-color: #64748b;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #94a3b8;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* Clean Auth Pages Styling */
        .auth-wrapper {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
            overflow: hidden;
        }

        .floating-orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.3;
            animation: floatOrb 20s ease-in-out infinite;
        }

        .orb-1 {
            width: 500px;
            height: 500px;
            background: rgba(255, 255, 255, 0.2);
            top: -250px;
            right: -150px;
        }

        .orb-2 {
            width: 400px;
            height: 400px;
            background: rgba(255, 255, 255, 0.15);
            bottom: -200px;
            left: -100px;
        }

        .orb-3 {
            width: 350px;
            height: 350px;
            background: rgba(255, 255, 255, 0.1);
            top: 40%;
            left: 40%;
        }

        @keyframes floatOrb {
            0%, 100% { transform: translate(0, 0); }
            33% { transform: translate(30px, -30px); }
            66% { transform: translate(-20px, 20px); }
        }

        .auth-container {
            position: relative;
            z-index: 10;
            width: 100%;
            max-width: 1000px;
            padding: 40px 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 60px;
        }

        /* Clean Glassmorphism Card */
        .auth-card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 16px;
            padding: 48px 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.5s ease-out;
            max-width: 450px;
            width: 100%;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Side Info Panel - Professional */
        .auth-info-panel {
            display: none;
            color: white;
            max-width: 400px;
        }

        @media (min-width: 992px) {
            .auth-info-panel {
                display: block;
            }
        }

        .auth-info-panel h2 {
            font-size: 42px;
            font-weight: 700;
            margin-bottom: 20px;
            line-height: 1.2;
        }

        .auth-info-panel p {
            font-size: 17px;
            line-height: 1.7;
            opacity: 0.95;
            margin-bottom: 32px;
        }

        .info-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            margin-top: 32px;
        }

        .stat-item {
            text-align: center;
            padding: 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .stat-number {
            font-size: 28px;
            font-weight: 700;
            display: block;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .auth-logo {
            text-align: center;
            margin-bottom: 32px;
        }

        .logo-icon-wrapper {
            display: inline-block;
            margin-bottom: 16px;
        }

        .auth-logo i {
            font-size: 40px;
            color: var(--primary-color);
        }

        .auth-logo h1 {
            font-size: 26px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .auth-logo p {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
        }

        .auth-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
            text-align: center;
            margin-bottom: 28px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            font-size: 14px;
            display: block;
        }

        .form-control-wrapper {
            position: relative;
        }

        .form-control-wrapper i {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 16px;
            transition: color 0.2s;
        }

        .form-control {
            width: 100%;
            padding: 12px 14px 12px 42px;
            border: 1.5px solid var(--border-color);
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.2s;
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-control-wrapper:focus-within i {
            color: var(--primary-color);
        }

        .password-toggle {
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: var(--text-muted);
            font-size: 16px;
            transition: color 0.2s;
        }

        .password-toggle:hover {
            color: var(--primary-color);
        }

        .btn-auth {
            width: 100%;
            padding: 12px;
            background: var(--primary-color);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 8px;
        }

        .btn-auth:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-auth i {
            margin-right: 6px;
        }

        .auth-divider {
            text-align: center;
            margin: 24px 0;
            position: relative;
        }

        .auth-divider::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            width: 100%;
            height: 1px;
            background: var(--border-color);
        }

        .auth-divider span {
            background: white;
            padding: 0 16px;
            color: var(--text-muted);
            font-size: 13px;
            position: relative;
            font-weight: 500;
        }

        .auth-link {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .auth-link a {
            color: var(--primary-color);
            font-weight: 600;
            text-decoration: none;
            transition: color 0.2s;
        }

        .auth-link a:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }

        .alert {
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 20px;
            border: 1px solid;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .alert-danger {
            background: #fef2f2;
            color: #991b1b;
            border-color: #fecaca;
        }

        .alert-success {
            background: #f0fdf4;
            color: #065f46;
            border-color: #bbf7d0;
        }

        .alert-warning {
            background: #fffbeb;
            color: #92400e;
            border-color: #fde68a;
        }

        .alert-info {
            background: #eff6ff;
            color: #1e40af;
            border-color: #bfdbfe;
        }

        .alert i {
            font-size: 18px;
        }

        .btn-close {
            margin-left: auto;
            opacity: 0.6;
            transition: opacity 0.2s;
        }

        .btn-close:hover {
            opacity: 1;
        }

        .password-strength {
            height: 4px;
            background: var(--bg-tertiary);
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
        }

        .password-strength-bar {
            height: 100%;
            width: 0;
            transition: all 0.3s;
            border-radius: 2px;
        }

        .password-strength-bar.weak {
            width: 33%;
            background: var(--danger-color);
        }

        .password-strength-bar.medium {
            width: 66%;
            background: var(--warning-color);
        }

        .password-strength-bar.strong {
            width: 100%;
            background: var(--success-color);
        }

        .features-list {
            list-style: none;
            padding: 0;
            margin: 20px 0 0 0;
        }

        .features-list li {
            padding: 10px 0;
            color: var(--text-secondary);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .features-list li i {
            color: var(--success-color);
            font-size: 16px;
        }

        .verification-input {
            text-align: center;
            letter-spacing: 12px !important;
            font-size: 24px !important;
            font-weight: 600 !important;
            padding: 16px !important;
        }

        /* Professional Dashboard Styles */
        .container { 
            max-width: 1400px; 
            margin: 0 auto;
            padding: 24px;
        }
        
        /* Clean Navbar */
        .navbar {
            background: white !important;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 1rem 1.5rem;
            border-radius: 12px;
            margin-bottom: 28px;
            border: 1px solid var(--border-color);
        }

        .navbar-brand {
            font-weight: 700;
            color: var(--text-primary) !important;
            font-size: 20px;
        }

        .navbar-brand i {
            color: var(--primary-color);
            margin-right: 8px;
        }

        .navbar-nav .nav-link {
            color: var(--text-secondary) !important;
            font-weight: 500;
            padding: 8px 14px !important;
            border-radius: 6px;
            transition: all 0.2s;
            margin: 0 2px;
            font-size: 14px;
        }

        .navbar-nav .nav-link:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary) !important;
        }

        .navbar-nav .nav-link i {
            margin-right: 6px;
            font-size: 13px;
        }

        /* Clean Dashboard Cards */
        .dashboard-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
            border: 1px solid var(--border-color);
        }

        .dashboard-card h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .dashboard-card h3 i {
            color: var(--primary-color);
            font-size: 18px;
        }

        /* Minimal Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 28px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            border: 1px solid var(--border-color);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: all 0.2s;
        }

        .stat-card:hover {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .stat-card.green {
            border-left: 3px solid var(--success-color);
        }

        .stat-card.orange {
            border-left: 3px solid var(--warning-color);
        }

        .stat-card.pink {
            border-left: 3px solid #ec4899;
        }

        .stat-card.blue {
            border-left: 3px solid var(--primary-color);
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 500;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .stat-subtext {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .stat-icon {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 32px;
            opacity: 0.1;
            color: var(--text-primary);
        }

        /* Clean Notification Alerts */
        #notificationsContainer {
            margin-bottom: 28px;
        }

        #notificationsContainer .alert {
            background: white;
            border: 1px solid var(--border-color);
            border-left: 3px solid var(--warning-color);
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 12px;
        }

        #notificationsContainer .alert i {
            color: var(--warning-color);
        }

        #notificationsContainer .alert strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        /* Clean Table */
        .table-wrapper {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .table {
            margin-bottom: 0;
            background: transparent;
        }

        .table thead th {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 12px;
            padding: 16px;
            border: none;
        }

        .table tbody tr {
            transition: background 0.2s;
            border-bottom: 1px solid var(--bg-tertiary);
        }

        .table tbody tr:hover {
            background: var(--bg-secondary);
        }

        .table tbody td {
            padding: 16px;
            vertical-align: middle;
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .table tbody td:first-child {
            font-weight: 600;
            color: var(--text-primary);
        }

        .price-positive {
            color: var(--success-color);
            font-weight: 600;
        }

        .price-negative {
            color: var(--danger-color);
            font-weight: 600;
        }

        /* Clean Buttons */
        .btn-sm {
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 13px;
            transition: all 0.2s;
            border: none;
        }

        .btn-info {
            background: var(--primary-color);
            color: white;
        }

        .btn-info:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            color: white;
        }

        .btn-primary {
            background: var(--success-color);
            border: none;
            color: white;
        }

        .btn-primary:hover {
            background: #059669;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--secondary-color);
            border: none;
            color: white;
        }

        .btn-secondary:hover {
            background: #475569;
            transform: translateY(-1px);
        }

        /* Clean Chart Container */
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 24px;
            border: 1px solid var(--border-color);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-top: 24px;
            height: 450px;
            position: relative;
        }

        .chart-container::before {
            content: 'Select a cryptocurrency to view historical data';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--text-muted);
            font-size: 15px;
            font-weight: 500;
            text-align: center;
            z-index: 0;
            pointer-events: none;
        }

        .chart-container canvas {
            position: relative;
            z-index: 1;
        }

        .alert-dismissible {
            position: relative;
        }

        /* Clean Empty State */
        .empty-state {
            text-align: center;
            padding: 48px 20px;
            color: var(--text-muted);
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.4;
        }

        .empty-state h4 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        .empty-state p {
            font-size: 14px;
            color: var(--text-muted);
        }
        
        /* Quick Action Cards */
        .card {
            transition: all 0.3s ease;
            background: white;
        }
        
        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }

        /* Responsive */
        @media (max-width: 992px) {
            .auth-container {
                flex-direction: column;
                gap: 32px;
            }
        }

        @media (max-width: 576px) {
            .auth-card {
                padding: 32px 24px;
            }
            
            .auth-logo h1 {
                font-size: 22px;
            }
            
            .auth-title {
                font-size: 20px;
            }

            .auth-info-panel h2 {
                font-size: 32px;
            }

            .floating-orb {
                display: none;
            }
        }

        /* Clean Pagination */
        .pagination {
            margin: 24px 0;
        }

        .pagination .page-link {
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            padding: 8px 14px;
            margin: 0 4px;
            border-radius: 6px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .pagination .page-link:hover {
            background: var(--bg-tertiary);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .pagination .page-item.active .page-link {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .pagination .page-link i {
            font-size: 12px;
        }
    </style>
</head>
<body>
    {% if section == 'login' %}
        <div class="auth-wrapper">
            <div class="floating-orb orb-1"></div>
            <div class="floating-orb orb-2"></div>
            <div class="floating-orb orb-3"></div>
            
            <div class="auth-container">
                <!-- Left Info Panel -->
                <div class="auth-info-panel">
                    <h2>Welcome Back to the Future of Crypto</h2>
                    <p>Track your portfolio in real-time, get intelligent alerts, and make data-driven decisions with advanced risk analytics.</p>
                    
                    <div class="info-stats">
                        <div class="stat-item">
                            <span class="stat-number">$10K</span>
                            <span class="stat-label">Virtual Balance</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">500+</span>
                            <span class="stat-label">Cryptocurrencies</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">24/7</span>
                            <span class="stat-label">Live Tracking</span>
                        </div>
                    </div>
                </div>

                <!-- Auth Card -->
                <div class="auth-card">
                    <div class="auth-logo">
                        <div class="logo-icon-wrapper">
                            <div class="logo-glow"></div>
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h1>CoinPrep Simulator</h1>
                        <p>AI-Powered Portfolio Manager</p>
                    </div>

                    <h2 class="auth-title">Sign In</h2>

                    {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            {% for category, message in messages %}
                                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                                    <i class="fas fa-{% if category == 'danger' %}exclamation-circle{% elif category == 'success' %}check-circle{% elif category == 'warning' %}exclamation-triangle{% else %}info-circle{% endif %}"></i>
                                    <span>{{ message }}</span>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}
                    {% if error %}
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>{{ error }}</span>
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endif %}

                    <form method="POST" action="{{ url_for('login') }}" id="loginForm">
                        <div class="form-group">
                            <label for="username" class="form-label">Username</label>
                            <div class="form-control-wrapper">
                                <i class="fas fa-user"></i>
                                <input type="text" class="form-control" id="username" name="username" placeholder="Enter your username" required autocomplete="username">
                                <div class="input-highlight"></div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="password" class="form-label">Password</label>
                            <div class="form-control-wrapper">
                                <i class="fas fa-lock"></i>
                                <input type="password" class="form-control" id="password" name="password" placeholder="Enter your password" required autocomplete="current-password">
                                <i class="fas fa-eye password-toggle" onclick="togglePassword('password')"></i>
                                <div class="input-highlight"></div>
                            </div>
                        </div>

                        <button type="submit" class="btn-auth">
                            <i class="fas fa-sign-in-alt"></i> Sign In
                        </button>
                    </form>

                    <div class="auth-link">
                        Don't have an account? <a href="{{ url_for('register') }}">Create Account</a>
                    </div>

                    <div class="auth-divider">
                        <span>Features</span>
                    </div>

                    <ul class="features-list">
                        <li><i class="fas fa-check-circle"></i> Real-time portfolio tracking</li>
                        <li><i class="fas fa-check-circle"></i> Advanced risk analysis</li>
                        <li><i class="fas fa-check-circle"></i> Smart price alerts</li>
                    </ul>
                </div>
            </div>
        </div>

    {% elif section == 'register' %}
        <div class="auth-wrapper">
            <div class="floating-orb orb-1"></div>
            <div class="floating-orb orb-2"></div>
            <div class="floating-orb orb-3"></div>
            
            <div class="auth-container">
                <!-- Left Info Panel -->
                <div class="auth-info-panel">
                    <h2>Start Your Crypto Journey Today</h2>
                    <p>Join thousands of investors using AI-powered analytics to make smarter trading decisions and maximize returns.</p>
                    
                    <div class="info-stats">
                        <div class="stat-item">
                            <span class="stat-number">1000+</span>
                            <span class="stat-label">Active Users</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">95%</span>
                            <span class="stat-label">Success Rate</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">Free</span>
                            <span class="stat-label">Forever</span>
                        </div>
                    </div>
                </div>

                <!-- Auth Card -->
                <div class="auth-card">
                    <div class="auth-logo">
                        <div class="logo-icon-wrapper">
                            <div class="logo-glow"></div>
                            <i class="fas fa-rocket"></i>
                        </div>
                        <h1>CoinPrep Simulator</h1>
                        <p>Start Your Success Story</p>
                    </div>

                    <h2 class="auth-title">Create Account</h2>

                    {% if error %}
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>{{ error }}</span>
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endif %}

                    <form method="POST" action="{{ url_for('register') }}" id="registerForm">
                        <div class="form-group">
                            <label for="username" class="form-label">Username</label>
                            <div class="form-control-wrapper">
                                <i class="fas fa-user"></i>
                                <input type="text" class="form-control" id="username" name="username" placeholder="Choose a username" required autocomplete="username">
                                <div class="input-highlight"></div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="email" class="form-label">Email Address</label>
                            <div class="form-control-wrapper">
                                <i class="fas fa-envelope"></i>
                                <input type="email" class="form-control" id="email" name="email" placeholder="Enter your email" required autocomplete="email">
                                <div class="input-highlight"></div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="password" class="form-label">Password</label>
                            <div class="form-control-wrapper">
                                <i class="fas fa-lock"></i>
                                <input type="password" class="form-control" id="password" name="password" placeholder="Create a strong password" required autocomplete="new-password" oninput="checkPasswordStrength(this.value)">
                                <i class="fas fa-eye password-toggle" onclick="togglePassword('password')"></i>
                                <div class="input-highlight"></div>
                            </div>
                            <div class="password-strength">
                                <div class="password-strength-bar" id="passwordStrengthBar"></div>
                            </div>
                        </div>

                        <button type="submit" class="btn-auth">
                            <i class="fas fa-user-plus"></i> Create Account
                        </button>
                    </form>

                    <div class="auth-link">
                        Already have an account? <a href="{{ url_for('login') }}">Sign In</a>
                    </div>

                    <div class="auth-divider">
                        <span>What You'll Get</span>
                    </div>

                    <ul class="features-list">
                        <li><i class="fas fa-check-circle"></i> $10,000 virtual CryptoBucks</li>
                        <li><i class="fas fa-check-circle"></i> Email price alerts</li>
                        <li><i class="fas fa-check-circle"></i> Strategy backtesting</li>
                        <li><i class="fas fa-check-circle"></i> Risk assessment tools</li>
                    </ul>
                </div>
            </div>
        </div>
    
    {% elif section == 'verify' %}
        <div class="auth-wrapper">
            <div class="floating-orb orb-1"></div>
            <div class="floating-orb orb-2"></div>
            <div class="floating-orb orb-3"></div>
            
            <div class="auth-container">
                <!-- Auth Card -->
                <div class="auth-card">
                    <div class="auth-logo">
                        <div class="logo-icon-wrapper">
                            <div class="logo-glow"></div>
                            <i class="fas fa-envelope-open-text"></i>
                        </div>
                        <h1>Verify Your Email</h1>
                        <p>Almost there!</p>
                    </div>

                    <h2 class="auth-title">Enter Verification Code</h2>

                    {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            {% for category, message in messages %}
                                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                                    <i class="fas fa-{% if category == 'danger' %}exclamation-circle{% elif category == 'success' %}check-circle{% elif category == 'warning' %}exclamation-triangle{% else %}info-circle{% endif %}"></i>
                                    <span>{{ message }}</span>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
                            {% endfor %}
                        {% endif %} 
                    {% endwith %}
                    {% if error %}
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>{{ error }}</span>
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endif %}

                    <div class="alert alert-info" role="alert">
                        <i class="fas fa-info-circle"></i>
                        <span>A 6-digit verification code has been sent to your email.</span>
                    </div>

                    <form method="POST" action="{{ url_for('verify', email=email) }}">
                        <div class="form-group">
                            <label for="code" class="form-label">Verification Code</label>
                            <div class="form-control-wrapper">
                                <i class="fas fa-key"></i>
                                <input type="text" class="form-control verification-input" id="code" name="code" placeholder="000000" maxlength="6" pattern="[A-Z0-9]{6}" required style="text-transform: uppercase;">
                                <div class="input-highlight"></div>
                            </div>
                        </div>

                        <button type="submit" class="btn-auth">
                            <i class="fas fa-check-circle"></i> Verify Account
                        </button>
                    </form>

                    <div class="auth-link">
                        <a href="{{ url_for('login') }}"><i class="fas fa-arrow-left"></i> Back to Login</a>
                    </div>
                </div>
            </div>
        </div>

    {% elif section == 'dashboard' %}
        <div class="container">
            <nav class="navbar navbar-expand-lg navbar-light">
                <a class="navbar-brand" href="#"><i class="fas fa-chart-line"></i> CoinPrep Simulator</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <div class="navbar-nav ms-auto">
                        <a class="nav-link" href="{{ url_for('live_market') }}"><i class="fas fa-store"></i> Live Market</a>
                        <a class="nav-link" href="{{ url_for('portfolio') }}"><i class="fas fa-briefcase"></i> Portfolio</a>
                        <a class="nav-link" href="{{ url_for('orders') }}"><i class="fas fa-list-ul"></i> Orders</a>
                        <a class="nav-link" href="{{ url_for('watchlist') }}"><i class="fas fa-star"></i> Watchlist</a>
                        <a class="nav-link" href="{{ url_for('alerts') }}"><i class="fas fa-bell"></i> Alerts</a>
                        <a class="nav-link" href="{{ url_for('learning') }}"><i class="fas fa-graduation-cap"></i> Learn</a>
                        <a class="nav-link" href="{{ url_for('backtester') }}"><i class="fas fa-history"></i> Backtester</a>
                        <a class="nav-link" href="{{ url_for('risk_quiz') }}"><i class="fas fa-shield-alt"></i> Risk Quiz</a>
                        <a class="nav-link" href="{{ url_for('achievements') }}"><i class="fas fa-trophy"></i> Achievements</a>
                        <a class="nav-link" href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i> Logout</a>
                    </div>
                </div>
            </nav>

            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <!-- Stats Grid -->
            {% if user %}
            <div class="stats-grid">
                <div class="stat-card">
                    <i class="fas fa-wallet stat-icon"></i>
                    <div class="stat-label">CryptoBucks Balance</div>
                    <div class="stat-value">${{ user.crypto_bucks | round(2) }}</div>
                    <small class="text-muted">Virtual currency for trading</small>
                </div>
                <div class="stat-card blue">
                    <i class="fas fa-coins stat-icon"></i>
                    <div class="stat-label">USDT Balance</div>
                    <div class="stat-value">${{ user.tether_balance | default(0) | round(2) }}</div>
                    <small class="text-muted">Stablecoin for crypto trading</small>
                </div>
                <div class="stat-card green">
                    <i class="fas fa-shield-alt stat-icon"></i>
                    <div class="stat-label">Risk Tolerance</div>
                    <div class="stat-value">{{ user.risk_tolerance | capitalize if user.risk_tolerance else 'Not Set' }}</div>
                </div>
                <div class="stat-card orange">
                    <i class="fas fa-chart-line stat-icon"></i>
                    <div class="stat-label">Active Alerts</div>
                    <div class="stat-value">{{ triggered_alerts|length if triggered_alerts else 0 }}</div>
                </div>
            </div>
            {% endif %}

            <!-- Price Alert Notifications -->
            <div class="dashboard-card" style="padding: 15px;">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="mb-0"><i class="fas fa-bell"></i> Price Alerts</h5>
                    <form method="POST" action="{{ url_for('refresh_alerts') }}">
                        <button type="submit" class="btn btn-outline-secondary btn-sm" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </form>
                </div>
                <div id="notificationsContainer">
                    {% if triggered_alerts %}
                        {% for alert in triggered_alerts %}
                            <div class="alert alert-warning alert-dismissible fade show" role="alert" style="padding: 0.5rem 0.75rem; margin-bottom: 0.5rem;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-exclamation-triangle" style="font-size: 18px; color: #f59e0b;"></i>
                                    <div style="flex: 1; font-size: 0.875rem;">
                                        <strong>{{ alert.coin_id | capitalize }}</strong> is {{ alert.alert_type }} ${{ alert.target_price | round(2) }}
                                        <small class="d-block text-muted">{{ alert.triggered_at }}</small>
                                    </div>
                                    <a href="{{ url_for('live_market') }}" class="btn btn-sm btn-primary" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;">Trade</a>
                                    <form method="POST" action="{{ url_for('dismiss_alert', notification_id=alert.id) }}" style="display:inline;">
                                        <button type="submit" class="btn btn-sm btn-outline-secondary" style="font-size: 0.75rem; padding: 0.25rem 0.5rem;">Dismiss</button>
                                    </form>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-2">
                            <small class="text-muted"><i class="fas fa-bell-slash"></i> No active alerts</small>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Market Highlights Grid -->
            <div class="row g-3 mb-4">
                <!-- Top Gainers -->
                <div class="col-md-6">
                    <div class="dashboard-card">
                        <h3><i class="fas fa-rocket" style="color: #10b981;"></i> Top Gainers (24h)</h3>
                        <p class="text-muted small mb-3">ðŸ’¡ <strong>Learning Tip:</strong> High gainers show strong bullish momentum but can be volatile. Always research before investing.</p>
                        <div class="table-wrapper">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Coin</th>
                                        <th>Price</th>
                                        <th>24h Change</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if top_gainers %}
                                        {% for coin in top_gainers %}
                                            <tr>
                                                <td><strong>{{ coin.name }}</strong> <small class="text-muted">{{ coin.symbol | upper }}</small></td>
                                                <td>${{ coin.current_price | round(4) }}</td>
                                                <td class="price-positive">
                                                    <i class="fas fa-arrow-up"></i> {{ coin.price_change_percentage_24h | round(2) }}%
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr><td colspan="3" class="text-center text-muted">Loading...</td></tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Top Losers -->
                <div class="col-md-6">
                    <div class="dashboard-card">
                        <h3><i class="fas fa-arrow-trend-down" style="color: #ef4444;"></i> Top Losers (24h)</h3>
                        <p class="text-muted small mb-3">ðŸ’¡ <strong>Learning Tip:</strong> Losers might indicate bearish sentiment. Consider if it's a buying opportunity or a warning sign.</p>
                        <div class="table-wrapper">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Coin</th>
                                        <th>Price</th>
                                        <th>24h Change</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if top_losers %}
                                        {% for coin in top_losers %}
                                            <tr>
                                                <td><strong>{{ coin.name }}</strong> <small class="text-muted">{{ coin.symbol | upper }}</small></td>
                                                <td>${{ coin.current_price | round(4) }}</td>
                                                <td class="price-negative">
                                                    <i class="fas fa-arrow-down"></i> {{ coin.price_change_percentage_24h | round(2) }}%
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr><td colspan="3" class="text-center text-muted">Loading...</td></tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Trending Coins -->
                <div class="col-md-6">
                    <div class="dashboard-card">
                        <h3><i class="fas fa-fire" style="color: #f59e0b;"></i> Trending Coins</h3>
                        <p class="text-muted small mb-3">ðŸ’¡ <strong>Learning Tip:</strong> Trending coins have high search interest. Popularity doesn't always equal value.</p>
                        <div class="table-wrapper">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Rank</th>
                                        <th>Coin</th>
                                        <th>Market Cap Rank</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if trending_coins %}
                                        {% for item in trending_coins %}
                                            <tr>
                                                <td><strong>#{{ loop.index }}</strong></td>
                                                <td><strong>{{ item.item.name }}</strong> <small class="text-muted">{{ item.item.symbol | upper }}</small></td>
                                                <td><span class="badge bg-secondary">#{{ item.item.market_cap_rank }}</span></td>
                                            </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr><td colspan="3" class="text-center text-muted">Loading...</td></tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- High Volume Coins -->
                <div class="col-md-6">
                    <div class="dashboard-card">
                        <h3><i class="fas fa-chart-bar" style="color: #8b5cf6;"></i> Highest Trading Volume</h3>
                        <p class="text-muted small mb-3">ðŸ’¡ <strong>Learning Tip:</strong> High volume indicates strong market activity and liquidity. Easier to buy/sell.</p>
                        <div class="table-wrapper">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Coin</th>
                                        <th>Price</th>
                                        <th>24h Volume</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if high_volume_coins %}
                                        {% for coin in high_volume_coins %}
                                            <tr>
                                                <td><strong>{{ coin.name }}</strong> <small class="text-muted">{{ coin.symbol | upper }}</small></td>
                                                <td>${{ coin.current_price | round(2) }}</td>
                                                <td><span class="badge bg-info">${{ '{:,.0f}'.format(coin.total_volume) }}</span></td>
                                            </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr><td colspan="3" class="text-center text-muted">Loading...</td></tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Educational Insights -->
            <div class="dashboard-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <h3><i class="fas fa-graduation-cap"></i> Today's Trading Insights</h3>
                <div class="row mt-4">
                    <div class="col-md-3">
                        <div class="text-center p-3" style="background: rgba(255,255,255,0.1); border-radius: 10px; margin-bottom: 15px;">
                            <i class="fas fa-lightbulb fa-2x mb-2"></i>
                            <h5>Diversification</h5>
                            <p class="small">Don't put all eggs in one basket. Spread investments across multiple assets to reduce risk.</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center p-3" style="background: rgba(255,255,255,0.1); border-radius: 10px; margin-bottom: 15px;">
                            <i class="fas fa-shield-alt fa-2x mb-2"></i>
                            <h5>Risk Management</h5>
                            <p class="small">Use stop-loss orders to protect against major losses. Never invest more than you can afford to lose.</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center p-3" style="background: rgba(255,255,255,0.1); border-radius: 10px; margin-bottom: 15px;">
                            <i class="fas fa-chart-line fa-2x mb-2"></i>
                            <h5>Technical Analysis</h5>
                            <p class="small">Study price charts, volume, and indicators like MA & RSI to make informed decisions.</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center p-3" style="background: rgba(255,255,255,0.1); border-radius: 10px; margin-bottom: 15px;">
                            <i class="fas fa-clock fa-2x mb-2"></i>
                            <h5>Long-term Thinking</h5>
                            <p class="small">Crypto markets are volatile. Consider holding quality assets for the long term to ride out volatility.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Market Overview -->
            <div class="dashboard-card">
                <h3><i class="fas fa-globe"></i> Market Overview (Top Market Caps)</h3>
                <div class="table-wrapper">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Coin</th>
                                <th>Price (USD)</th>
                                <th>24h Change</th>
                                <th>Market Cap</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if coins %}
                                {% for coin in coins %}
                                    <tr>
                                        <td><strong>{{ coin.name }}</strong></td>
                                        <td><strong>${{ coin.current_price | round(2) }}</strong></td>
                                        <td>
                                            <span class="{% if coin.price_change_percentage_24h > 0 %}price-positive{% else %}price-negative{% endif %}">
                                                <i class="fas fa-{% if coin.price_change_percentage_24h > 0 %}arrow-up{% else %}arrow-down{% endif %}"></i>
                                                {{ coin.price_change_percentage_24h | round(2) }}%
                                            </span>
                                        </td>
                                        <td>${{ '{:,.0f}'.format(coin.market_cap) }}</td>
                                        <td>
                                            <button class="btn btn-sm btn-info" onclick="showDashboardChart('{{ coin.id }}'); return false;">
                                                <i class="fas fa-chart-area"></i> View Chart
                                            </button>
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="5" class="text-center text-muted py-4">No market data available</td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Chart Container -->
            <div class="chart-container">
                <canvas id="priceChartDashboard"></canvas>
            </div>

            <script>
                (function() {
                    let chartInstance = null;
                    
                    window.showDashboardChart = function(coinId) {
                        // Show loading state
                        const chartContainer = document.querySelector('.chart-container');
                        chartContainer.style.opacity = '0.5';
                        
                        fetch(`/historical/${coinId}`)
                            .then(response => response.json())
                            .then(data => {
                                chartContainer.style.opacity = '1';
                                
                                if (data.error) {
                                    alert(data.error);
                                    return;
                                }
                                
                                const ctx = document.getElementById('priceChartDashboard').getContext('2d');
                                
                                // Destroy existing chart
                                if (chartInstance) {
                                    chartInstance.destroy();
                                }
                                
                                // Create new chart with enhanced styling
                                chartInstance = new Chart(ctx, {
                                    type: 'line',
                                    data: {
                                        labels: data.dates,
                                        datasets: [
                                            {
                                                label: `${coinId.toUpperCase()} Price (USD)`,
                                                data: data.prices,
                                                borderColor: '#667eea',
                                                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                                                borderWidth: 3,
                                                yAxisID: 'y-price',
                                                fill: true,
                                                tension: 0.4,
                                                pointRadius: 0,
                                                pointHoverRadius: 6,
                                                pointHoverBackgroundColor: '#667eea',
                                                pointHoverBorderColor: '#fff',
                                                pointHoverBorderWidth: 2
                                            },
                                            {
                                                label: `${coinId.toUpperCase()} Volume (USD)`,
                                                data: data.volumes,
                                                borderColor: '#10b981',
                                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                                borderWidth: 2,
                                                yAxisID: 'y-volume',
                                                fill: true,
                                                tension: 0.4,
                                                pointRadius: 0,
                                                pointHoverRadius: 6,
                                                pointHoverBackgroundColor: '#10b981',
                                                pointHoverBorderColor: '#fff',
                                                pointHoverBorderWidth: 2
                                            },
                                            {
                                                label: `${coinId.toUpperCase()} Market Cap (USD)`,
                                                data: data.market_caps,
                                                borderColor: '#f59e0b',
                                                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                                borderWidth: 2,
                                                yAxisID: 'y-market-cap',
                                                fill: true,
                                                tension: 0.4,
                                                pointRadius: 0,
                                                pointHoverRadius: 6,
                                                pointHoverBackgroundColor: '#f59e0b',
                                                pointHoverBorderColor: '#fff',
                                                pointHoverBorderWidth: 2
                                            }
                                        ]
                                    },
                                    options: {
                                        responsive: true,
                                        maintainAspectRatio: false,
                                        interaction: {
                                            mode: 'index',
                                            intersect: false,
                                        },
                                        plugins: {
                                            legend: {
                                                display: true,
                                                position: 'top',
                                                labels: {
                                                    usePointStyle: true,
                                                    padding: 20,
                                                    font: {
                                                        size: 13,
                                                        weight: '600'
                                                    }
                                                }
                                            },
                                            tooltip: {
                                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                                padding: 12,
                                                titleFont: {
                                                    size: 14,
                                                    weight: 'bold'
                                                },
                                                bodyFont: {
                                                    size: 13
                                                },
                                                cornerRadius: 8
                                            }
                                        },
                                        scales: {
                                            x: {
                                                display: true,
                                                title: {
                                                    display: true,
                                                    text: 'Date',
                                                    font: {
                                                        size: 14,
                                                        weight: 'bold'
                                                    },
                                                    color: '#64748b'
                                                },
                                                grid: {
                                                    display: false
                                                },
                                                ticks: {
                                                    color: '#64748b',
                                                    font: {
                                                        size: 12
                                                    }
                                                }
                                            },
                                            'y-price': {
                                                type: 'linear',
                                                display: true,
                                                position: 'left',
                                                title: {
                                                    display: true,
                                                    text: 'Price (USD)',
                                                    font: {
                                                        size: 14,
                                                        weight: 'bold'
                                                    },
                                                    color: '#667eea'
                                                },
                                                grid: {
                                                    color: 'rgba(0, 0, 0, 0.05)'
                                                },
                                                ticks: {
                                                    color: '#667eea',
                                                    font: {
                                                        size: 12,
                                                        weight: '600'
                                                    }
                                                }
                                            },
                                            'y-volume': {
                                                type: 'linear',
                                                display: true,
                                                position: 'right',
                                                title: {
                                                    display: true,
                                                    text: 'Volume (USD)',
                                                    font: {
                                                        size: 14,
                                                        weight: 'bold'
                                                    },
                                                    color: '#10b981'
                                                },
                                                grid: {
                                                    drawOnChartArea: false
                                                },
                                                ticks: {
                                                    color: '#10b981',
                                                    font: {
                                                        size: 12,
                                                        weight: '600'
                                                    }
                                                }
                                            },
                                            'y-market-cap': {
                                                type: 'linear',
                                                display: false,
                                                position: 'right'
                                            }
                                        }
                                    }
                                });
                            })
                            .catch(error => {
                                chartContainer.style.opacity = '1';
                                console.error('Error fetching chart data:', error);
                                alert('Failed to load chart data. Please try again.');
                            });
                    };
                })();
            </script>

            <!-- Onboarding Tutorial Modal -->
            {% if show_onboarding %}
            <div class="modal fade" id="onboardingModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
                <div class="modal-dialog modal-lg modal-dialog-centered">
                    <div class="modal-content" style="border-radius: 15px; overflow: hidden;">
                        <div class="modal-body p-0">
                            <!-- Step 1: Welcome -->
                            <div class="onboarding-step active" data-step="1">
                                <div class="text-center p-5" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                                    <i class="fas fa-rocket fa-4x mb-3"></i>
                                    <h2>Welcome to CoinPrep! ðŸŽ‰</h2>
                                    <p class="lead">Your Safe Space to Learn Crypto Trading</p>
                                    <p>This is a <strong>demo simulator</strong> - No real money involved! Practice trading with virtual currency and learn at your own pace.</p>
                                </div>
                            </div>
                            
                            <!-- Step 2: What is Crypto -->
                            <div class="onboarding-step" data-step="2">
                                <div class="p-5">
                                    <h3><i class="fas fa-bitcoin text-warning"></i> What is Cryptocurrency?</h3>
                                    <p class="lead">Think of cryptocurrency as <strong>digital money</strong> that exists only online.</p>
                                    <ul class="list-group list-group-flush mt-4">
                                        <li class="list-group-item"><i class="fas fa-check-circle text-success"></i> <strong>No physical coins</strong> - It's all digital</li>
                                        <li class="list-group-item"><i class="fas fa-check-circle text-success"></i> <strong>Decentralized</strong> - No bank controls it</li>
                                        <li class="list-group-item"><i class="fas fa-check-circle text-success"></i> <strong>Bitcoin was the first</strong> - Created in 2009</li>
                                        <li class="list-group-item"><i class="fas fa-check-circle text-success"></i> <strong>Thousands exist now</strong> - Ethereum, BNB, and more</li>
                                    </ul>
                                    <div class="alert alert-info mt-4">
                                        <strong>Simple Example:</strong> Just like you can send an email instead of a letter, cryptocurrency lets you send money digitally without a bank!
                                    </div>
                                </div>
                            </div>

                            <!-- Step 3: What is Trading -->
                            <div class="onboarding-step" data-step="3">
                                <div class="p-5">
                                    <h3><i class="fas fa-exchange-alt text-primary"></i> What is Trading?</h3>
                                    <p class="lead">Trading = <strong>Buying Low, Selling High</strong></p>
                                    <div class="row mt-4">
                                        <div class="col-md-6">
                                            <div class="card border-success">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-shopping-cart fa-3x text-success mb-3"></i>
                                                    <h5>Buy (Going Long)</h5>
                                                    <p>You <strong>buy</strong> Bitcoin at $50,000</p>
                                                    <p>Price goes up to $55,000</p>
                                                    <p class="text-success"><strong>You sell = $5,000 profit! âœ…</strong></p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card border-danger">
                                                <div class="card-body text-center">
                                                    <i class="fas fa-chart-line fa-3x text-danger mb-3"></i>
                                                    <h5>Risk</h5>
                                                    <p>You buy Bitcoin at $50,000</p>
                                                    <p>Price drops to $45,000</p>
                                                    <p class="text-danger"><strong>You sell = $5,000 loss âŒ</strong></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Step 4: Order Types -->
                            <div class="onboarding-step" data-step="4">
                                <div class="p-5">
                                    <h3><i class="fas fa-list-alt text-info"></i> Types of Orders</h3>
                                    <div class="accordion mt-4" id="orderTypesAccordion">
                                        <div class="accordion-item">
                                            <h2 class="accordion-header">
                                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#marketOrder">
                                                    <i class="fas fa-bolt text-warning me-2"></i> Market Order - Buy NOW!
                                                </button>
                                            </h2>
                                            <div id="marketOrder" class="accordion-collapse collapse show" data-bs-parent="#orderTypesAccordion">
                                                <div class="accordion-body">
                                                    Buys immediately at current price. <strong>Fast but no control over exact price.</strong>
                                                    <br><em>Example: Bitcoin is $50,000 now, you click "Buy Market" and get it instantly at $50,000 (or close to it).</em>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="accordion-item">
                                            <h2 class="accordion-header">
                                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#limitOrder">
                                                    <i class="fas fa-clock text-primary me-2"></i> Limit Order - Set Your Price
                                                </button>
                                            </h2>
                                            <div id="limitOrder" class="accordion-collapse collapse" data-bs-parent="#orderTypesAccordion">
                                                <div class="accordion-body">
                                                    Only buys when price reaches YOUR target. <strong>More control, but might not execute if price doesn't reach your level.</strong>
                                                    <br><em>Example: Bitcoin is $50,000 but you set limit at $48,000. Order waits. If price drops to $48,000, it buys automatically!</em>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="accordion-item">
                                            <h2 class="accordion-header">
                                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#stopLoss">
                                                    <i class="fas fa-shield-alt text-danger me-2"></i> Stop Loss - Protection
                                                </button>
                                            </h2>
                                            <div id="stopLoss" class="accordion-collapse collapse" data-bs-parent="#orderTypesAccordion">
                                                <div class="accordion-body">
                                                    Automatically sells if price drops too much. <strong>Protects you from big losses!</strong>
                                                    <br><em>Example: You bought at $50,000, set stop-loss at $45,000. If price crashes to $45,000, it sells automatically to limit your loss.</em>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Step 5: Risk Management -->
                            <div class="onboarding-step" data-step="5">
                                <div class="p-5">
                                    <h3><i class="fas fa-shield-alt text-success"></i> Golden Rules of Trading</h3>
                                    <div class="row mt-4">
                                        <div class="col-md-6 mb-3">
                                            <div class="card h-100 border-warning">
                                                <div class="card-body">
                                                    <h5><i class="fas fa-exclamation-triangle text-warning"></i> Never Invest More Than You Can Lose</h5>
                                                    <p class="small">Only use money you're okay with losing. Don't use rent money or savings!</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <div class="card h-100 border-info">
                                                <div class="card-body">
                                                    <h5><i class="fas fa-layer-group text-info"></i> Diversify</h5>
                                                    <p class="small">Don't put all money in one coin. Spread it across multiple cryptocurrencies.</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <div class="card h-100 border-danger">
                                                <div class="card-body">
                                                    <h5><i class="fas fa-heart text-danger"></i> Control Emotions</h5>
                                                    <p class="small">Don't panic sell when price drops. Don't FOMO buy when everyone's buying. Stick to your plan!</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <div class="card h-100 border-success">
                                                <div class="card-body">
                                                    <h5><i class="fas fa-book text-success"></i> Keep Learning</h5>
                                                    <p class="small">Markets change. Keep reading, practicing, and improving your skills.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Navigation Buttons -->
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" id="skipTutorial">Skip for Now</button>
                                <div>
                                    <span id="stepIndicator" class="me-3 text-muted">Step 1 of 5</span>
                                    <button type="button" class="btn btn-outline-primary" id="prevStep" disabled>Previous</button>
                                    <button type="button" class="btn btn-primary" id="nextStep">Next</button>
                                    <button type="button" class="btn btn-success" id="finishTutorial" style="display:none;">Start Trading! ðŸš€</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <script>
                // Onboarding Modal Logic
                document.addEventListener('DOMContentLoaded', function() {
                    const modal = document.getElementById('onboardingModal');
                    if (modal) {
                        const bsModal = new bootstrap.Modal(modal);
                        bsModal.show();

                        let currentStep = 1;
                        const totalSteps = 5;

                        function showStep(step) {
                            document.querySelectorAll('.onboarding-step').forEach(el => el.classList.remove('active'));
                            document.querySelector(`.onboarding-step[data-step="${step}"]`).classList.add('active');
                            
                            document.getElementById('stepIndicator').textContent = `Step ${step} of ${totalSteps}`;
                            document.getElementById('prevStep').disabled = step === 1;
                            document.getElementById('nextStep').style.display = step === totalSteps ? 'none' : 'inline-block';
                            document.getElementById('finishTutorial').style.display = step === totalSteps ? 'inline-block' : 'none';
                        }

                        document.getElementById('nextStep').addEventListener('click', function() {
                            if (currentStep < totalSteps) {
                                currentStep++;
                                showStep(currentStep);
                            }
                        });

                        document.getElementById('prevStep').addEventListener('click', function() {
                            if (currentStep > 1) {
                                currentStep--;
                                showStep(currentStep);
                            }
                        });

                        document.getElementById('skipTutorial').addEventListener('click', function() {
                            fetch('/skip_onboarding', { method: 'POST' })
                                .then(() => bsModal.hide());
                        });

                        document.getElementById('finishTutorial').addEventListener('click', function() {
                            fetch('/skip_onboarding', { method: 'POST' })
                                .then(() => {
                                    bsModal.hide();
                                    alert('ðŸŽ‰ Great job! You can always revisit the lessons in the "Learn" section from the top menu.');
                                });
                        });
                    }
                });
            </script>

            <style>
                .onboarding-step {
                    display: none;
                }
                .onboarding-step.active {
                    display: block;
                }
            </style>
            {% endif %}
        </div>

    {% elif section == 'learning' %}
        <div class="container">
            <nav class="navbar navbar-expand-lg">
                <a class="navbar-brand" href="{{ url_for('dashboard') }}"><i class="fas fa-arrow-left"></i> CoinPrep Learning Hub</a>
                <div class="navbar-nav ms-auto">
                    <a class="nav-link" href="{{ url_for('dashboard') }}"><i class="fas fa-home"></i> Dashboard</a>
                    <a class="nav-link" href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i> Logout</a>
                </div>
            </nav>

            <!-- Progress Banner -->
            <div class="dashboard-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h2><i class="fas fa-graduation-cap"></i> Your Learning Journey</h2>
                        <p class="mb-0">Complete all 7 lessons to master crypto trading basics!</p>
                    </div>
                    <div class="col-md-4 text-end">
                        <div class="progress" style="height: 30px; background: rgba(255,255,255,0.3);">
                            <div class="progress-bar bg-success" role="progressbar" style="width: {{ (user_progress.lessons_completed|length / 7 * 100)|round }}%;" id="progressBar">
                                <strong>{{ user_progress.lessons_completed|length }}/7 Complete</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Lesson Cards -->
            <div class="row g-4">
                <!-- Lesson 1: What is Crypto -->
                <div class="col-md-6">
                    <div class="dashboard-card lesson-card {% if 'lesson1' in user_progress.lessons_completed %}completed{% endif %}" data-lesson="lesson1">
                        <div class="d-flex justify-content-between align-items-start">
                            <h4><i class="fas fa-bitcoin text-warning"></i> Lesson 1: What is Cryptocurrency?</h4>
                            <span class="badge bg-success completion-badge" style="display: {% if 'lesson1' in user_progress.lessons_completed %}inline{% else %}none{% endif %};">âœ“ Done</span>
                        </div>
                        <p class="text-muted">Learn the basics of digital currency and how it works</p>
                        <button class="btn btn-primary btn-sm" onclick="showLesson('lesson1')">
                            {% if 'lesson1' in user_progress.lessons_completed %}Review{% else %}Start Lesson{% endif %}
                        </button>
                    </div>
                </div>

                <!-- Lesson 2: Trading Basics -->
                <div class="col-md-6">
                    <div class="dashboard-card lesson-card {% if 'lesson2' in user_progress.lessons_completed %}completed{% endif %}" data-lesson="lesson2">
                        <div class="d-flex justify-content-between align-items-start">
                            <h4><i class="fas fa-exchange-alt text-primary"></i> Lesson 2: What is Trading?</h4>
                            <span class="badge bg-success completion-badge" style="display: {% if 'lesson2' in user_progress.lessons_completed %}inline{% else %}none{% endif %};">âœ“ Done</span>
                        </div>
                        <p class="text-muted">Understand buying, selling, and making profits</p>
                        <button class="btn btn-primary btn-sm" onclick="showLesson('lesson2')">
                            {% if 'lesson2' in user_progress.lessons_completed %}Review{% else %}Start Lesson{% endif %}
                        </button>
                    </div>
                </div>

                <!-- Lesson 3: Trading Pairs -->
                <div class="col-md-6">
                    <div class="dashboard-card lesson-card {% if 'lesson3' in user_progress.lessons_completed %}completed{% endif %}" data-lesson="lesson3">
                        <div class="d-flex justify-content-between align-items-start">
                            <h4><i class="fas fa-link text-info"></i> Lesson 3: Trading Pairs</h4>
                            <span class="badge bg-success completion-badge" style="display: {% if 'lesson3' in user_progress.lessons_completed %}inline{% else %}none{% endif %};">âœ“ Done</span>
                        </div>
                        <p class="text-muted">Learn BTC/USDT, ETH/USD and how pairs work</p>
                        <button class="btn btn-primary btn-sm" onclick="showLesson('lesson3')">
                            {% if 'lesson3' in user_progress.lessons_completed %}Review{% else %}Start Lesson{% endif %}
                        </button>
                    </div>
                </div>

                <!-- Lesson 4: Order Types -->
                <div class="col-md-6">
                    <div class="dashboard-card lesson-card {% if 'lesson4' in user_progress.lessons_completed %}completed{% endif %}" data-lesson="lesson4">
                        <div class="d-flex justify-content-between align-items-start">
                            <h4><i class="fas fa-list-alt text-success"></i> Lesson 4: Market vs Limit Orders</h4>
                            <span class="badge bg-success completion-badge" style="display: {% if 'lesson4' in user_progress.lessons_completed %}inline{% else %}none{% endif %};">âœ“ Done</span>
                        </div>
                        <p class="text-muted">Master different order types and when to use them</p>
                        <button class="btn btn-primary btn-sm" onclick="showLesson('lesson4')">
                            {% if 'lesson4' in user_progress.lessons_completed %}Review{% else %}Start Lesson{% endif %}
                        </button>
                    </div>
                </div>

                <!-- Lesson 5: Stop Loss -->
                <div class="col-md-6">
                    <div class="dashboard-card lesson-card {% if 'lesson5' in user_progress.lessons_completed %}completed{% endif %}" data-lesson="lesson5">
                        <div class="d-flex justify-content-between align-items-start">
                            <h4><i class="fas fa-shield-alt text-danger"></i> Lesson 5: Stop Loss & Take Profit</h4>
                            <span class="badge bg-success completion-badge" style="display: {% if 'lesson5' in user_progress.lessons_completed %}inline{% else %}none{% endif %};">âœ“ Done</span>
                        </div>
                        <p class="text-muted">Protect your investments with smart risk tools</p>
                        <button class="btn btn-primary btn-sm" onclick="showLesson('lesson5')">
                            {% if 'lesson5' in user_progress.lessons_completed %}Review{% else %}Start Lesson{% endif %}
                        </button>
                    </div>
                </div>

                <!-- Lesson 6: Risk Management -->
                <div class="col-md-6">
                    <div class="dashboard-card lesson-card {% if 'lesson6' in user_progress.lessons_completed %}completed{% endif %}" data-lesson="lesson6">
                        <div class="d-flex justify-content-between align-items-start">
                            <h4><i class="fas fa-balance-scale text-warning"></i> Lesson 6: Risk Management</h4>
                            <span class="badge bg-success completion-badge" style="display: {% if 'lesson6' in user_progress.lessons_completed %}inline{% else %}none{% endif %};">âœ“ Done</span>
                        </div>
                        <p class="text-muted">Learn to manage risk and position sizing</p>
                        <button class="btn btn-primary btn-sm" onclick="showLesson('lesson6')">
                            {% if 'lesson6' in user_progress.lessons_completed %}Review{% else %}Start Lesson{% endif %}
                        </button>
                    </div>
                </div>

                <!-- Lesson 7: Psychology -->
                <div class="col-md-6">
                    <div class="dashboard-card lesson-card {% if 'lesson7' in user_progress.lessons_completed %}completed{% endif %}" data-lesson="lesson7">
                        <div class="d-flex justify-content-between align-items-start">
                            <h4><i class="fas fa-brain text-purple"></i> Lesson 7: Trading Psychology</h4>
                            <span class="badge bg-success completion-badge" style="display: {% if 'lesson7' in user_progress.lessons_completed %}inline{% else %}none{% endif %};">âœ“ Done</span>
                        </div>
                        <p class="text-muted">Master your emotions and avoid common mistakes</p>
                        <button class="btn btn-primary btn-sm" onclick="showLesson('lesson7')">
                            {% if 'lesson7' in user_progress.lessons_completed %}Review{% else %}Start Lesson{% endif %}
                        </button>
                    </div>
                </div>
            </div>

            <!-- Lesson Modal -->
            <div class="modal fade" id="lessonModal" tabindex="-1">
                <div class="modal-dialog modal-lg modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="lessonTitle"></h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body" id="lessonContent"></div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-success" id="completeLessonBtn">Mark as Complete âœ“</button>
                        </div>
                    </div>
                </div>
            </div>

            <script>
                const lessonContent = {
                    lesson1: {
                        title: 'What is Cryptocurrency?',
                        content: `
                            <h4>ðŸª™ Digital Money</h4>
                            <p>Cryptocurrency is <strong>digital money</strong> that exists only on the internet - no paper bills or metal coins!</p>
                            
                            <h5 class="mt-4">Key Concepts:</h5>
                            <ul>
                                <li><strong>Blockchain:</strong> Think of it like a digital ledger (notebook) that records every transaction. Everyone can see it, but no one can change past records.</li>
                                <li><strong>Decentralized:</strong> No single company or government controls it. It's like the internet - belongs to everyone!</li>
                                <li><strong>Bitcoin (BTC):</strong> The first and most famous cryptocurrency. Like digital gold.</li>
                                <li><strong>Ethereum (ETH):</strong> Second biggest. Can run "smart contracts" (automatic agreements).</li>
                                <li><strong>Altcoins:</strong> All other cryptocurrencies besides Bitcoin.</li>
                            </ul>

                            <div class="alert alert-info mt-4">
                                <h6><i class="fas fa-lightbulb"></i> Real World Example:</h6>
                                <p>Imagine sending money to a friend overseas:</p>
                                <p><strong>Traditional way:</strong> Bank transfer takes 3-5 days, charges fees, bank controls it</p>
                                <p><strong>Crypto way:</strong> Send Bitcoin in 10-30 minutes, lower fees, no middleman!</p>
                            </div>

                            <h5 class="mt-4">Quick Quiz:</h5>
                            <div class="card bg-light p-3">
                                <p><strong>Q: What makes cryptocurrency different from regular money?</strong></p>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="quiz1" id="quiz1a">
                                    <label class="form-check-label" for="quiz1a">A) It's controlled by banks</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="quiz1" id="quiz1b">
                                    <label class="form-check-label" for="quiz1b">B) It's digital and decentralized âœ“</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="quiz1" id="quiz1c">
                                    <label class="form-check-label" for="quiz1c">C) It exists as physical coins</label>
                                </div>
                            </div>
                        `
                    },
                    lesson2: {
                        title: 'What is Trading?',
                        content: `
                            <h4>ðŸ“ˆ Buy Low, Sell High</h4>
                            <p>Trading is about making profit from price changes. Simple concept: buy something cheap, sell it expensive!</p>
                            
                            <div class="row mt-4">
                                <div class="col-md-6">
                                    <div class="card border-success">
                                        <div class="card-body">
                                            <h5 class="text-success"><i class="fas fa-check-circle"></i> Profitable Trade</h5>
                                            <ol>
                                                <li>You buy 1 Bitcoin at $40,000</li>
                                                <li>Price goes up to $45,000</li>
                                                <li>You sell for $45,000</li>
                                                <li><strong>Profit: $5,000! ðŸŽ‰</strong></li>
                                            </ol>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card border-danger">
                                        <div class="card-body">
                                            <h5 class="text-danger"><i class="fas fa-times-circle"></i> Loss Trade</h5>
                                            <ol>
                                                <li>You buy 1 Bitcoin at $40,000</li>
                                                <li>Price drops to $35,000</li>
                                                <li>You panic and sell at $35,000</li>
                                                <li><strong>Loss: -$5,000 ðŸ˜¢</strong></li>
                                            </ol>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <h5 class="mt-4">Types of Traders:</h5>
                            <ul>
                                <li><strong>Day Trader:</strong> Buys and sells within the same day. Very active!</li>
                                <li><strong>Swing Trader:</strong> Holds for days or weeks. Medium term.</li>
                                <li><strong>HODLer:</strong> Buys and holds for months/years. Long-term investor.</li>
                            </ul>

                            <div class="alert alert-warning mt-4">
                                <h6><i class="fas fa-exclamation-triangle"></i> Remember:</h6>
                                <p>Crypto prices are <strong>very volatile</strong> (change a lot). You can make OR lose money quickly. That's why this is a simulator - to practice safely!</p>
                            </div>
                        `
                    },
                    lesson3: {
                        title: 'Trading Pairs',
                        content: `
                            <h4>ðŸ”— Understanding Trading Pairs</h4>
                            <p>A trading pair shows two currencies being exchanged. Format: <strong>BASE/QUOTE</strong></p>
                            
                            <h5 class="mt-4">Common Examples:</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card bg-light mb-3">
                                        <div class="card-body">
                                            <h6><strong>BTC/USDT</strong></h6>
                                            <p>Bitcoin (BTC) priced in Tether (USDT - a stablecoin worth ~$1)</p>
                                            <p class="text-muted small">If BTC/USDT = 50,000, it means 1 Bitcoin costs 50,000 USDT (~$50,000)</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card bg-light mb-3">
                                        <div class="card-body">
                                            <h6><strong>ETH/BTC</strong></h6>
                                            <p>Ethereum (ETH) priced in Bitcoin (BTC)</p>
                                            <p class="text-muted small">If ETH/BTC = 0.05, it means 1 Ethereum costs 0.05 Bitcoin</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <h5 class="mt-4">Why Pairs Matter:</h5>
                            <ul>
                                <li><strong>Choose your risk:</strong> BTC/USDT is stable (priced in dollars). BTC/ETH is more volatile.</li>
                                <li><strong>Different strategies:</strong> Trade crypto-to-crypto or crypto-to-stablecoin</li>
                                <li><strong>Price differences:</strong> Same coin can have different prices in different pairs!</li>
                            </ul>

                            <div class="alert alert-info mt-4">
                                <h6><i class="fas fa-lightbulb"></i> Pro Tip:</h6>
                                <p>For beginners, trade with <strong>USDT or USD pairs</strong> first. They're easier to understand because prices are in dollars!</p>
                            </div>
                        `
                    },
                    lesson4: {
                        title: 'Market vs Limit Orders',
                        content: `
                            <h4>âš¡ Market Order: Buy/Sell NOW!</h4>
                            <div class="card bg-primary text-white mb-4">
                                <div class="card-body">
                                    <h5>Market Order</h5>
                                    <p><strong>Executes immediately</strong> at the current best available price</p>
                                    <p><strong>âœ… Pros:</strong> Fast, guaranteed execution</p>
                                    <p><strong>âŒ Cons:</strong> Price might slip (you pay a bit more or get a bit less)</p>
                                    <p class="mb-0"><strong>Use when:</strong> You want to buy/sell RIGHT NOW and don't care about exact price</p>
                                </div>
                            </div>

                            <h4>ðŸŽ¯ Limit Order: Set Your Price!</h4>
                            <div class="card bg-success text-white mb-4">
                                <div class="card-body">
                                    <h5>Limit Order</h5>
                                    <p><strong>Only executes</strong> when price reaches YOUR specified level</p>
                                    <p><strong>âœ… Pros:</strong> Full control over price, potentially better deals</p>
                                    <p><strong>âŒ Cons:</strong> Might not execute if price doesn't reach your level</p>
                                    <p class="mb-0"><strong>Use when:</strong> You want a specific price and can wait</p>
                                </div>
                            </div>

                            <h5>Example Scenario:</h5>
                            <div class="card bg-light">
                                <div class="card-body">
                                    <p><strong>Current Bitcoin Price: $50,000</strong></p>
                                    <hr>
                                    <p><strong>Market Order:</strong> Click "Buy Market" â†’ You get Bitcoin at ~$50,000 instantly</p>
                                    <p><strong>Limit Order:</strong> Set limit at $48,000 â†’ Order waits. If price drops to $48,000, you buy automatically. If not, no trade happens.</p>
                                </div>
                            </div>

                            <div class="alert alert-warning mt-4">
                                <strong>Beginner Tip:</strong> Start with small market orders to practice. Once comfortable, try limit orders for better prices!
                            </div>
                        `
                    },
                    lesson5: {
                        title: 'Stop Loss & Take Profit',
                        content: `
                            <h4>ðŸ›¡ï¸ Stop Loss: Your Safety Net</h4>
                            <p>A Stop Loss automatically <strong>sells your position</strong> if the price drops to a certain level. It protects you from big losses!</p>
                            
                            <div class="card border-danger mb-4">
                                <div class="card-body">
                                    <h5 class="text-danger">Stop Loss Example:</h5>
                                    <ol>
                                        <li>You buy Bitcoin at $50,000</li>
                                        <li>You set stop loss at $45,000 (10% below)</li>
                                        <li>Price drops to $45,000</li>
                                        <li><strong>Automatically sells!</strong> You lose $5,000, but it stops there</li>
                                        <li>Price keeps dropping to $30,000 - but you're already out! You avoided bigger loss! âœ…</li>
                                    </ol>
                                </div>
                            </div>

                            <h4>ðŸŽ¯ Take Profit: Lock in Gains</h4>
                            <p>Take Profit automatically <strong>sells when price goes UP</strong> to your target. It secures your profits!</p>
                            
                            <div class="card border-success mb-4">
                                <div class="card-body">
                                    <h5 class="text-success">Take Profit Example:</h5>
                                    <ol>
                                        <li>You buy Bitcoin at $50,000</li>
                                        <li>You set take profit at $55,000 (10% above)</li>
                                        <li>Price rises to $55,000</li>
                                        <li><strong>Automatically sells!</strong> You made $5,000 profit! ðŸŽ‰</li>
                                        <li>You don't have to watch the market 24/7!</li>
                                    </ol>
                                </div>
                            </div>

                            <div class="alert alert-info mt-4">
                                <h6><i class="fas fa-lightbulb"></i> Pro Strategy:</h6>
                                <p>Use BOTH together! Set stop loss at -10% and take profit at +20%. This gives you a good risk/reward ratio!</p>
                                <p><strong>Risk:</strong> Lose $1,000 | <strong>Reward:</strong> Win $2,000 â†’ Good trade!</p>
                            </div>

                            <div class="alert alert-warning">
                                <strong>Remember:</strong> Always set a stop loss! It's like wearing a seatbelt - you hope you don't need it, but you're glad it's there!
                            </div>
                        `
                    },
                    lesson6: {
                        title: 'Risk Management',
                        content: `
                            <h4>âš–ï¸ The Golden Rules of Risk Management</h4>
                            
                            <h5>1. The 1-2% Rule</h5>
                            <div class="card bg-light mb-3">
                                <div class="card-body">
                                    <p><strong>Never risk more than 1-2% of your total capital on a single trade!</strong></p>
                                    <p>Example: If you have $10,000:</p>
                                    <ul>
                                        <li>Maximum risk per trade: $100-200</li>
                                        <li>This means even 10 losing trades in a row = still 90%+ of capital left</li>
                                        <li>You can stay in the game!</li>
                                    </ul>
                                </div>
                            </div>

                            <h5>2. Position Sizing</h5>
                            <div class="card bg-light mb-3">
                                <div class="card-body">
                                    <p><strong>Don't put all your money in one cryptocurrency!</strong></p>
                                    <p>Good diversification:</p>
                                    <ul>
                                        <li>40% in Bitcoin (most stable)</li>
                                        <li>30% in Ethereum (second biggest)</li>
                                        <li>20% in 2-3 other established coins</li>
                                        <li>10% in smaller/riskier coins (if you want)</li>
                                    </ul>
                                </div>
                            </div>

                            <h5>3. Risk/Reward Ratio</h5>
                            <div class="card bg-light mb-3">
                                <div class="card-body">
                                    <p><strong>Aim for at least 1:2 risk/reward ratio</strong></p>
                                    <p>Example:</p>
                                    <ul>
                                        <li>Risk: $100 (with stop loss)</li>
                                        <li>Potential Reward: $200+ (with take profit)</li>
                                        <li>This means you only need to win 35-40% of trades to be profitable!</li>
                                    </ul>
                                </div>
                            </div>

                            <h5>4. Never Chase Losses</h5>
                            <div class="alert alert-danger">
                                <h6><i class="fas fa-exclamation-triangle"></i> WARNING!</h6>
                                <p><strong>Emotional mistake:</strong> You lose money, then immediately make bigger trades to "win it back"</p>
                                <p><strong>Result:</strong> Usually lose even MORE money!</p>
                                <p><strong>Solution:</strong> Take a break. Stick to your plan. Small consistent wins beat big emotional bets!</p>
                            </div>

                            <div class="alert alert-success mt-4">
                                <h6>Remember:</h6>
                                <p><strong>Good traders protect their capital first, make profits second!</strong></p>
                                <p>It's better to make small consistent gains than to risk everything for one big win.</p>
                            </div>
                        `
                    },
                    lesson7: {
                        title: 'Trading Psychology',
                        content: `
                            <h4>ðŸ§  Master Your Mind, Master Trading</h4>
                            <p>Technical skills are only 30% of trading. Psychology is 70%! Let's learn to control emotions.</p>
                            
                            <h5>Common Emotional Mistakes:</h5>
                            
                            <div class="card border-danger mb-3">
                                <div class="card-body">
                                    <h6 class="text-danger">ðŸ˜± Fear (Panic Selling)</h6>
                                    <p><strong>What happens:</strong> Price drops 5%, you panic and sell at a loss</p>
                                    <p><strong>Solution:</strong> Set stop losses in advance. Trust your plan. Small dips are normal!</p>
                                </div>
                            </div>

                            <div class="card border-warning mb-3">
                                <div class="card-body">
                                    <h6 class="text-warning">ðŸ˜¤ Greed (FOMO - Fear Of Missing Out)</h6>
                                    <p><strong>What happens:</strong> Everyone's buying, prices shooting up, you buy at the peak. Then it crashes.</p>
                                    <p><strong>Solution:</strong> Stick to your analysis. If you missed a rally, there will be another one. Patience!</p>
                                </div>
                            </div>

                            <div class="card border-info mb-3">
                                <div class="card-body">
                                    <h6 class="text-info">ðŸ˜” Revenge Trading</h6>
                                    <p><strong>What happens:</strong> You lose money, get angry, make bigger reckless trades to "win it back"</p>
                                    <p><strong>Solution:</strong> Take a break after losses. Come back calm. Follow your system!</p>
                                </div>
                            </div>

                            <h5 class="mt-4">5 Mental Rules for Success:</h5>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card bg-light mb-3">
                                        <div class="card-body">
                                            <h6>1. Have a Trading Plan</h6>
                                            <p class="small">Write down your strategy BEFORE trading. When to buy, when to sell, how much risk.</p>
                                        </div>
                                    </div>
                                    <div class="card bg-light mb-3">
                                        <div class="card-body">
                                            <h6>2. Accept Losses</h6>
                                            <p class="small">Even pro traders lose 40-50% of trades. It's normal! Focus on overall profit.</p>
                                        </div>
                                    </div>
                                    <div class="card bg-light mb-3">
                                        <div class="card-body">
                                            <h6>3. Keep a Trading Journal</h6>
                                            <p class="small">Write down every trade. What did you do right? Wrong? Learn from it!</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card bg-light mb-3">
                                        <div class="card-body">
                                            <h6>4. Take Breaks</h6>
                                            <p class="small">Don't stare at charts 24/7. Set alerts, walk away, live your life!</p>
                                        </div>
                                    </div>
                                    <div class="card bg-light mb-3">
                                        <div class="card-body">
                                            <h6>5. Start Small</h6>
                                            <p class="small">Use this simulator to practice. When ready for real money, start with amounts you can afford to lose.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="alert alert-success mt-4">
                                <h6><i class="fas fa-trophy"></i> Final Wisdom:</h6>
                                <p><strong>"The market will always be there. Your capital won't if you don't protect it."</strong></p>
                                <p>Trade smart, stay disciplined, control emotions = Long-term success! ðŸš€</p>
                            </div>
                        `
                    }
                };

                function showLesson(lessonId) {
                    const lesson = lessonContent[lessonId];
                    if (!lesson) return;

                    document.getElementById('lessonTitle').innerHTML = lesson.title;
                    document.getElementById('lessonContent').innerHTML = lesson.content;
                    document.getElementById('completeLessonBtn').setAttribute('data-lesson', lessonId);

                    const modal = new bootstrap.Modal(document.getElementById('lessonModal'));
                    modal.show();
                }

                document.getElementById('completeLessonBtn').addEventListener('click', function() {
                    const lessonId = this.getAttribute('data-lesson');
                    
                    fetch('/complete_lesson', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ lesson_id: lessonId })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Update UI
                            const card = document.querySelector(`[data-lesson="${lessonId}"]`);
                            card.classList.add('completed');
                            card.querySelector('.completion-badge').style.display = 'inline';
                            card.querySelector('button').textContent = 'Review';
                            
                            // Update progress bar
                            const progress = (data.completed_count / 7 * 100);
                            document.getElementById('progressBar').style.width = progress + '%';
                            document.getElementById('progressBar').innerHTML = `<strong>${data.completed_count}/7 Complete</strong>`;
                            
                            // Close modal and show congrats
                            bootstrap.Modal.getInstance(document.getElementById('lessonModal')).hide();
                            
                            if (data.completed_count === 7) {
                                alert('ðŸŽ‰ Congratulations! You\'ve completed all lessons! You\'re ready to start trading!');
                            } else {
                                alert('âœ… Lesson completed! Keep going!');
                            }
                        }
                    });
                });
            </script>

            <style>
                .lesson-card {
                    transition: transform 0.2s, box-shadow 0.2s;
                    border-left: 4px solid #ddd;
                }
                .lesson-card:hover {
                    transform: translateY(-5px);
                    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
                }
                .lesson-card.completed {
                    border-left-color: #10b981;
                    background: #f0fdf4;
                }
                .text-purple {
                    color: #8b5cf6;
                }
            </style>
        </div>

    {% elif section == 'live_market' %}
        <div class="container">
            <nav class="navbar navbar-expand-lg">
                <a class="navbar-brand" href="{{ url_for('dashboard') }}"><i class="fas fa-arrow-left"></i>CoinPrep</a>
                <div class="navbar-nav ms-auto">
                    <a class="nav-link" href="{{ url_for('portfolio') }}"><i class="fas fa-wallet"></i>Portfolio</a>
                    <a class="nav-link" href="{{ url_for('orders') }}"><i class="fas fa-list-ul"></i>Orders</a>
                    <a class="nav-link" href="{{ url_for('watchlist') }}"><i class="fas fa-star"></i>Watchlist</a>
                    <a class="nav-link" href="{{ url_for('alerts') }}"><i class="fas fa-bell"></i>Alerts</a>
                    <a class="nav-link" href="{{ url_for('risk_quiz') }}"><i class="fas fa-chart-line"></i>Risk Quiz</a>
                    <a class="nav-link" href="{{ url_for('achievements') }}"><i class="fas fa-trophy"></i>Achievements</a>
                    <a class="nav-link" href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i>Logout</a>
                </div>
            </nav>
            
            <div class="dashboard-card">
                <h3><i class="fas fa-chart-line"></i>Live Cryptocurrency Market</h3>
                <div class="table-wrapper">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Coin</th>
                                <th>Symbol</th>
                                <th>Price (USD)</th>
                                <th>24h Change</th>
                                <th>Market Cap</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if coins %}
                                {% for coin in coins %}
                                    <tr>
                                        <td><strong>{{ coin.name }}</strong></td>
                                        <td>{{ coin.symbol.upper() }}</td>
                                        <td><strong>${{ coin.current_price | round(2) }}</strong></td>
                                        <td class="{% if coin.price_change_percentage_24h > 0 %}price-positive{% else %}price-negative{% endif %}">
                                            {% if coin.price_change_percentage_24h > 0 %}
                                                <i class="fas fa-arrow-up"></i>
                                            {% else %}
                                                <i class="fas fa-arrow-down"></i>
                                            {% endif %}
                                            {{ coin.price_change_percentage_24h | round(2) }}%
                                        </td>
                                        <td>${{ "{:,.0f}".format(coin.market_cap) }}</td>
                                        <td>
                                            <form method="POST" action="{{ url_for('trade') }}" class="trade-form-compact">
                                                <input type="hidden" name="coin_id" value="{{ coin.id }}">
                                                <input type="hidden" name="current_price" value="{{ coin.current_price }}">
                                                <input type="hidden" name="source" value="live_market">
                                                
                                                <div class="mb-2">
                                                    <label class="form-label small mb-1"><strong>Order Type:</strong></label>
                                                    <select name="order_type" class="form-select form-select-sm" id="order_type_{{ coin.id }}" onchange="updateOrderFields('{{ coin.id }}')">
                                                        <option value="market">ðŸ’¨ Market (Instant)</option>
                                                        <option value="limit">â° Limit (Wait for Price)</option>
                                                        <option value="stop_loss">ðŸ›‘ Stop Loss (Protect)</option>
                                                        <option value="take_profit">ðŸŽ¯ Take Profit (Lock Gains)</option>
                                                    </select>
                                                    <small class="text-muted d-block mt-1" id="order_help_{{ coin.id }}">Executes immediately at market price</small>
                                                </div>
                                                
                                                <div class="input-group input-group-sm mb-2">
                                                    <input type="number" class="form-control" name="amount" placeholder="Amount" step="0.00000001" required>
                                                    <select name="wallet_id" class="form-select" required>
                                                        <option value="" disabled selected>Wallet</option>
                                                        {% if wallets %}
                                                            {% for wallet in wallets %}
                                                                <option value="{{ wallet.id }}">{{ wallet.name }}</option>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </select>
                                                </div>
                                                
                                                <div class="mb-2" id="quote_currency_{{ coin.id }}" style="display:block;">
                                                    <label class="form-label small mb-1"><strong>Pay With:</strong></label>
                                                    <select name="quote_currency" class="form-select form-select-sm">
                                                        <option value="cryptobucks">ðŸ’µ CryptoBucks ({{ user_balances.crypto_bucks|round(2) }})</option>
                                                        <option value="tether" {% if coin.id != 'tether' %}selected{% endif %}>ðŸ’° USDT ({{ user_balances.tether|round(2) }})</option>
                                                    </select>
                                                </div>
                                                
                                                <div class="mb-2" id="limit_price_{{ coin.id }}" style="display:none;">
                                                    <label class="form-label small mb-1"><strong>Limit Price ($):</strong></label>
                                                    <input type="number" class="form-control form-control-sm" name="limit_price" placeholder="Enter target price" step="0.01">
                                                    <small class="text-muted">Order executes when price reaches this level</small>
                                                </div>
                                                
                                                <div class="mb-2" id="stop_price_{{ coin.id }}" style="display:none;">
                                                    <label class="form-label small mb-1"><strong>Stop Price ($):</strong></label>
                                                    <input type="number" class="form-control form-control-sm" name="stop_price" placeholder="Enter trigger price" step="0.01">
                                                    <small class="text-muted d-block" id="stop_help_{{ coin.id }}"></small>
                                                </div>
                                                
                                                <div class="btn-group btn-group-sm w-100">
                                                    <button type="submit" name="action" value="buy" class="btn btn-success">Buy</button>
                                                    <button type="submit" name="action" value="sell" class="btn btn-danger">Sell</button>
                                                </div>
                                            </form>
                                            <button class="btn btn-sm btn-info mt-2 w-100" onclick="showLiveMarketChart('{{ coin.id }}'); return false;">
                                                <i class="fas fa-chart-line"></i> Chart
                                            </button>
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="6" class="text-center">
                                        <div class="empty-state">
                                            <i class="fas fa-coins"></i>
                                            <h4>No Market Data Available</h4>
                                            <p>Please refresh the page to load market data</p>
                                        </div>
                                    </td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
            
            {% if section == 'live_market' %}
                <nav aria-label="Market pagination">
                    <ul class="pagination justify-content-center">
                        {% if page > 1 %}
                            <li class="page-item">
                                <a class="page-link" href="{{ url_for('live_market', page=page-1) }}">
                                    <i class="fas fa-chevron-left"></i> Previous
                                </a>
                            </li>
                        {% endif %}
                        {% for p in range(1, total_pages + 1) %}
                            <li class="page-item {% if p == page %}active{% endif %}">
                                <a class="page-link" href="{{ url_for('live_market', page=p) }}">{{ p }}</a>
                            </li>
                        {% endfor %}
                        {% if page < total_pages %}
                            <li class="page-item">
                                <a class="page-link" href="{{ url_for('live_market', page=page+1) }}">
                                    Next <i class="fas fa-chevron-right"></i>
                                </a>
                            </li>
                        {% endif %}
                    </ul>
                </nav>
            {% endif %}
            
            <div class="chart-container" id="liveMarketChartContainer" style="opacity: 0; transition: opacity 0.3s;">
                <canvas id="liveMarketChart"></canvas>
            </div>
            
            <script>
                (function() {
                    let liveMarketChartInstance = null;
                    
                    window.showLiveMarketChart = function(coinId) {
                        const chartContainer = document.getElementById('liveMarketChartContainer');
                        chartContainer.style.opacity = '0.5';
                        
                        fetch(`/historical/${coinId}`)
                            .then(response => response.json())
                            .then(data => {
                                if (data.error) {
                                    alert(data.error);
                                    chartContainer.style.opacity = '1';
                                    return;
                                }
                                
                                const ctx = document.getElementById('liveMarketChart').getContext('2d');
                                
                                if (liveMarketChartInstance) {
                                    liveMarketChartInstance.destroy();
                                }
                                
                                liveMarketChartInstance = new Chart(ctx, {
                                    type: 'line',
                                    data: {
                                        labels: data.dates,
                                        datasets: [
                                            {
                                                label: `${coinId.toUpperCase()} Price (USD)`,
                                                data: data.prices,
                                                borderColor: '#2563eb',
                                                backgroundColor: 'rgba(37, 99, 235, 0.1)',
                                                borderWidth: 2,
                                                tension: 0.4,
                                                yAxisID: 'y-price',
                                                fill: true,
                                                pointRadius: 0,
                                                pointHoverRadius: 6,
                                                pointHoverBackgroundColor: '#2563eb',
                                                pointHoverBorderColor: '#fff',
                                                pointHoverBorderWidth: 2
                                            },
                                            {
                                                label: `${coinId.toUpperCase()} Volume (USD)`,
                                                data: data.volumes,
                                                borderColor: '#10b981',
                                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                                borderWidth: 2,
                                                tension: 0.4,
                                                yAxisID: 'y-volume',
                                                fill: true,
                                                pointRadius: 0,
                                                pointHoverRadius: 6,
                                                pointHoverBackgroundColor: '#10b981',
                                                pointHoverBorderColor: '#fff',
                                                pointHoverBorderWidth: 2
                                            }
                                        ]
                                    },
                                    options: {
                                        responsive: true,
                                        maintainAspectRatio: false,
                                        interaction: {
                                            mode: 'index',
                                            intersect: false
                                        },
                                        plugins: {
                                            legend: {
                                                display: true,
                                                position: 'top',
                                                labels: {
                                                    usePointStyle: true,
                                                    padding: 20,
                                                    font: {
                                                        size: 13,
                                                        weight: '600'
                                                    }
                                                }
                                            },
                                            tooltip: {
                                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                                padding: 12,
                                                titleFont: {
                                                    size: 14,
                                                    weight: 'bold'
                                                },
                                                bodyFont: {
                                                    size: 13
                                                },
                                                cornerRadius: 8
                                            }
                                        },
                                        scales: {
                                            x: {
                                                display: true,
                                                title: {
                                                    display: true,
                                                    text: 'Date',
                                                    font: {
                                                        size: 14,
                                                        weight: 'bold'
                                                    },
                                                    color: '#64748b'
                                                },
                                                grid: {
                                                    display: false
                                                },
                                                ticks: {
                                                    color: '#64748b',
                                                    font: {
                                                        size: 12
                                                    }
                                                }
                                            },
                                            'y-price': {
                                                type: 'linear',
                                                display: true,
                                                position: 'left',
                                                title: {
                                                    display: true,
                                                    text: 'Price (USD)',
                                                    font: {
                                                        size: 14,
                                                        weight: 'bold'
                                                    },
                                                    color: '#2563eb'
                                                },
                                                grid: {
                                                    color: 'rgba(0, 0, 0, 0.05)'
                                                },
                                                ticks: {
                                                    color: '#2563eb',
                                                    font: {
                                                        size: 12,
                                                        weight: '600'
                                                    }
                                                }
                                            },
                                            'y-volume': {
                                                type: 'linear',
                                                display: true,
                                                position: 'right',
                                                title: {
                                                    display: true,
                                                    text: 'Volume (USD)',
                                                    font: {
                                                        size: 14,
                                                        weight: 'bold'
                                                    },
                                                    color: '#10b981'
                                                },
                                                grid: {
                                                    drawOnChartArea: false
                                                },
                                                ticks: {
                                                    color: '#10b981',
                                                    font: {
                                                        size: 12,
                                                        weight: '600'
                                                    }
                                                }
                                            }
                                        }
                                    }
                                });
                                
                                chartContainer.style.opacity = '1';
                            })
                            .catch(error => {
                                chartContainer.style.opacity = '1';
                                console.error('Error fetching chart data:', error);
                                alert('Failed to load chart data. Please try again.');
                            });
                    };
                })();
                
                // Order type field toggling
                function updateOrderFields(coinId) {
                    const orderType = document.getElementById('order_type_' + coinId).value;
                    const limitPrice = document.getElementById('limit_price_' + coinId);
                    const stopPrice = document.getElementById('stop_price_' + coinId);
                    const quoteCurrency = document.getElementById('quote_currency_' + coinId);
                    const stopHelp = document.getElementById('stop_help_' + coinId);
                    const orderHelp = document.getElementById('order_help_' + coinId);
                    
                    // Hide all optional fields
                    limitPrice.style.display = 'none';
                    stopPrice.style.display = 'none';
                    quoteCurrency.style.display = 'block';
                    
                    // Show relevant fields and update help text based on order type
                    if (orderType === 'market') {
                        orderHelp.textContent = 'ðŸ’¨ Executes immediately at current market price';
                        quoteCurrency.style.display = 'block';
                    } else if (orderType === 'limit') {
                        orderHelp.textContent = 'â° Waits until price reaches your target level';
                        limitPrice.style.display = 'block';
                        quoteCurrency.style.display = 'block';
                    } else if (orderType === 'stop_loss') {
                        orderHelp.textContent = 'ðŸ›‘ Automatically sells if price drops below stop price';
                        stopPrice.style.display = 'block';
                        stopHelp.textContent = 'Protects against losses - sells if price drops to this level';
                    } else if (orderType === 'take_profit') {
                        orderHelp.textContent = 'ðŸŽ¯ Automatically sells if price rises above target';
                        stopPrice.style.display = 'block';
                        stopHelp.textContent = 'Locks in profits - sells if price rises to this level';
                    }
                }
            </script>
        </div>

    {% elif section == 'orders' %}
        <div class="container">
            <nav class="navbar navbar-expand-lg">
                <a class="navbar-brand" href="{{ url_for('dashboard') }}"><i class="fas fa-arrow-left"></i>CoinPrep</a>
                <div class="navbar-nav ms-auto">
                    <a class="nav-link" href="{{ url_for('live_market') }}"><i class="fas fa-chart-line"></i>Live Market</a>
                    <a class="nav-link" href="{{ url_for('portfolio') }}"><i class="fas fa-wallet"></i>Portfolio</a>
                    <a class="nav-link" href="{{ url_for('watchlist') }}"><i class="fas fa-star"></i>Watchlist</a>
                    <a class="nav-link" href="{{ url_for('alerts') }}"><i class="fas fa-bell"></i>Alerts</a>
                    <a class="nav-link" href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i>Logout</a>
                </div>
            </nav>
            
            <div class="dashboard-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3><i class="fas fa-list-ul"></i>My Trading Orders</h3>
                    <a href="{{ url_for('check_orders_now') }}" class="btn btn-primary btn-sm">
                        <i class="fas fa-sync-alt"></i> Check Orders Now
                    </a>
                </div>
                
                <!-- Open Orders -->
                <div class="mb-4">
                    <h4 class="mb-3"><i class="fas fa-clock"></i> Open Orders</h4>
                    {% if open_orders %}
                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Pair</th>
                                    <th>Type</th>
                                    <th>Side</th>
                                    <th>Amount</th>
                                    <th>Price/Stop</th>
                                    <th>Status</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for order in open_orders %}
                                <tr>
                                    <td><strong>{{ order.base_currency.upper() }}/{{ order.quote_currency.upper() }}</strong></td>
                                    <td>
                                        <span class="badge bg-{% if order.order_type == 'limit' %}primary{% elif order.order_type == 'stop_loss' %}danger{% elif order.order_type == 'take_profit' %}warning{% else %}success{% endif %}">
                                            {{ order.order_type.replace('_', ' ').title() }}
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge bg-{% if order.side == 'buy' %}success{% else %}danger{% endif %}">
                                            {{ order.side.upper() }}
                                        </span>
                                    </td>
                                    <td>{{ order.amount }}</td>
                                    <td>
                                        {% if order.price %}
                                            ${{ order.price | round(2) }}
                                        {% elif order.stop_price %}
                                            ${{ order.stop_price | round(2) }}
                                        {% else %}
                                            Market
                                        {% endif %}
                                    </td>
                                    <td>
                                        <span class="badge bg-warning">{{ order.status.title() }}</span>
                                    </td>
                                    <td>{{ order.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                                    <td>
                                        <form method="POST" action="/cancel_order/{{ order.id }}" style="display:inline;">
                                            <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Cancel this order?')">
                                                <i class="fas fa-times"></i> Cancel
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> No open orders. Visit the <a href="{{ url_for('live_market') }}">Live Market</a> to place your first order!
                    </div>
                    {% endif %}
                </div>
                
                <!-- Order History -->
                <div>
                    <h4 class="mb-3"><i class="fas fa-history"></i> Order History</h4>
                    {% if order_history %}
                    <div class="table-wrapper">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Pair</th>
                                    <th>Type</th>
                                    <th>Side</th>
                                    <th>Amount</th>
                                    <th>Price/Stop</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for order in order_history %}
                                <tr>
                                    <td>{{ order.base_currency.upper() }}/{{ order.quote_currency.upper() }}</td>
                                    <td>{{ order.order_type.replace('_', ' ').title() }}</td>
                                    <td>
                                        <span class="badge bg-{% if order.side == 'buy' %}success{% else %}danger{% endif %}">
                                            {{ order.side.upper() }}
                                        </span>
                                    </td>
                                    <td>{{ order.amount }}</td>
                                    <td>
                                        {% if order.price %}
                                            ${{ order.price | round(2) }}
                                        {% elif order.stop_price %}
                                            ${{ order.stop_price | round(2) }}
                                        {% endif %}
                                    </td>
                                    <td>
                                        <span class="badge bg-{% if order.status == 'filled' %}success{% else %}secondary{% endif %}">
                                            {{ order.status.title() }}
                                        </span>
                                    </td>
                                    <td>
                                        {% if order.filled_at %}
                                            {{ order.filled_at.strftime('%Y-%m-%d %H:%M') }}
                                        {% elif order.cancelled_at %}
                                            {{ order.cancelled_at.strftime('%Y-%m-%d %H:%M') }}
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> No order history yet.
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
    {% elif section == 'portfolio' %}
        <div class="container">
            <nav class="navbar navbar-expand-lg">
                <a class="navbar-brand" href="{{ url_for('dashboard') }}"><i class="fas fa-arrow-left"></i>CoinPrep</a>
                <div class="navbar-nav ms-auto">
                    <a class="nav-link" href="{{ url_for('live_market') }}"><i class="fas fa-chart-line"></i>Live Market</a>
                    <a class="nav-link" href="{{ url_for('watchlist') }}"><i class="fas fa-star"></i>Watchlist</a>
                    <a class="nav-link" href="{{ url_for('alerts') }}"><i class="fas fa-bell"></i>Alerts</a>
                    <a class="nav-link" href="{{ url_for('backtester') }}"><i class="fas fa-flask"></i>Backtester</a>
                    <a class="nav-link" href="{{ url_for('risk_quiz') }}"><i class="fas fa-question-circle"></i>Risk Quiz</a>
                    <a class="nav-link" href="{{ url_for('achievements') }}"><i class="fas fa-trophy"></i>Achievements</a>
                    <a class="nav-link" href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i>Logout</a>
                </div>
            </nav>
            
            <!-- Portfolio Summary -->
            <div class="dashboard-card">
                <h3><i class="fas fa-chart-pie"></i>Portfolio Summary</h3>
                <div class="row">
                    <div class="col-md-4">
                        <div class="stat-card">
                            <div class="stat-label">Total Realized Profit/Loss</div>
                            <div class="stat-value {% if total_profit >= 0 %}price-positive{% else %}price-negative{% endif %}">
                                {% if total_profit >= 0 %}+{% endif %}${{ total_profit | round(2) }}
                            </div>
                            <small class="text-muted">From completed sells</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="stat-card">
                            <div class="stat-label">Total Unrealized Profit/Loss</div>
                            <div class="stat-value {% if total_unrealized_profit >= 0 %}price-positive{% else %}price-negative{% endif %}">
                                {% if total_unrealized_profit >= 0 %}+{% endif %}${{ total_unrealized_profit | round(2) }}
                            </div>
                            <small class="text-muted">Current holdings value change</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="stat-card">
                            <div class="stat-label">Total Trading Fees Paid</div>
                            <div class="stat-value" style="color: #ef4444;">-${{ total_fees_paid | round(2) }}</div>
                            <small class="text-muted">0.1% fee per trade</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-card">
                <h3><i class="fas fa-plus-circle"></i>Add to Portfolio</h3>
                <form method="POST" action="{{ url_for('portfolio') }}">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <select name="wallet_id" class="form-select" required>
                                <option value="" disabled selected>Select Wallet</option>
                                {% if wallets %}
                                    {% for wallet in wallets %}
                                        <option value="{{ wallet.id }}">{{ wallet.name }}</option>
                                    {% endfor %}
                                {% else %}
                                    <option value="" disabled>No wallets available</option>
                                {% endif %}
                            </select>
                        </div>
                        <div class="col-md-3">
                            <input type="text" class="form-control" name="coin_id" placeholder="Coin ID (e.g., bitcoin)" required>
                        </div>
                        <div class="col-md-2">
                            <input type="number" class="form-control" name="amount" placeholder="Amount" step="0.00000001" required>
                        </div>
                        <div class="col-md-2">
                            <input type="number" class="form-control" name="purchase_price" placeholder="Price (USD)" step="0.01" required>
                        </div>
                        <div class="col-md-2">
                            <button type="submit" class="btn btn-primary w-100"><i class="fas fa-plus"></i> Add</button>
                        </div>
                    </div>
                </form>
            </div>
            
            <!-- Tabbed Portfolio Sections -->
            <div class="dashboard-card">
                <ul class="nav nav-tabs mb-3" id="portfolioTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="holdings-tab" data-bs-toggle="tab" data-bs-target="#holdings" type="button">
                            <i class="fas fa-coins"></i> Holdings (Avg Price)
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" type="button">
                            <i class="fas fa-history"></i> Trade History
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="details-tab" data-bs-toggle="tab" data-bs-target="#details" type="button">
                            <i class="fas fa-list"></i> Transaction Details
                        </button>
                    </li>
                </ul>
                
                <div class="tab-content" id="portfolioTabsContent">
                    <!-- Holdings Tab -->
                    <div class="tab-pane fade show active" id="holdings" role="tabpanel">
                        <div class="table-wrapper">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Coin</th>
                                        <th>Total Amount</th>
                                        <th>Average Buy Price</th>
                                        <th>Current Price</th>
                                        <th>Unrealized P/L</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if grouped_holdings %}
                                        {% for coin_id, holding in grouped_holdings.items() %}
                                            <tr>
                                                <td><strong>{{ coin_id.upper() }}</strong></td>
                                                <td>{{ holding.total_amount | round(8) }}</td>
                                                <td>${{ holding.avg_buy_price | round(2) }}</td>
                                                <td><strong>${{ holding.current_price | round(2) }}</strong></td>
                                                <td class="{% if holding.unrealized_profit >= 0 %}price-positive{% else %}price-negative{% endif %}">
                                                    {% if holding.unrealized_profit >= 0 %}
                                                        <i class="fas fa-arrow-up"></i>
                                                    {% else %}
                                                        <i class="fas fa-arrow-down"></i>
                                                    {% endif %}
                                                    {% if holding.unrealized_profit >= 0 %}+{% endif %}${{ holding.unrealized_profit | round(2) }}
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="5" class="text-center">
                                                <div class="empty-state">
                                                    <i class="fas fa-coins"></i>
                                                    <h4>No Holdings</h4>
                                                    <p>Start buying crypto to see your holdings</p>
                                                </div>
                                            </td>
                                        </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Trade History Tab -->
                    <div class="tab-pane fade" id="history" role="tabpanel">
                        <div class="table-wrapper">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Type</th>
                                        <th>Coin</th>
                                        <th>Amount</th>
                                        <th>Price</th>
                                        <th>Total Value</th>
                                        <th>Fee (0.1%)</th>
                                        <th>Profit/Loss</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if all_transactions %}
                                        {% for transaction in all_transactions %}
                                            <tr>
                                                <td>{{ transaction.formatted_date }}</td>
                                                <td>
                                                    {% if transaction.type == 'buy' %}
                                                        <span class="badge bg-success">BUY</span>
                                                    {% else %}
                                                        <span class="badge bg-danger">SELL</span>
                                                    {% endif %}
                                                </td>
                                                <td><strong>{{ transaction.coin_id.upper() }}</strong></td>
                                                <td>{{ transaction.amount | round(8) }}</td>
                                                <td>
                                                    {% if transaction.type == 'buy' %}
                                                        ${{ transaction.price | round(2) }}
                                                    {% else %}
                                                        ${{ transaction.sold_price | round(2) }}
                                                    {% endif %}
                                                </td>
                                                <td>
                                                    {% if transaction.type == 'buy' %}
                                                        ${{ (transaction.amount * transaction.price) | round(2) }}
                                                    {% else %}
                                                        ${{ (transaction.amount * transaction.sold_price) | round(2) }}
                                                    {% endif %}
                                                </td>
                                                <td style="color: #ef4444;">-${{ transaction.fee | round(2) }}</td>
                                                <td>
                                                    {% if transaction.type == 'sell' %}
                                                        {% set profit = (transaction.sold_price - transaction.price) * transaction.amount %}
                                                        {% set net_profit = profit - transaction.fee %}
                                                        <span class="{% if net_profit >= 0 %}price-positive{% else %}price-negative{% endif %}">
                                                            {% if net_profit >= 0 %}+{% endif %}${{ net_profit | round(2) }}
                                                        </span>
                                                        <small class="text-muted d-block">(Gross: ${{ profit | round(2) }})</small>
                                                    {% else %}
                                                        -
                                                    {% endif %}
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="8" class="text-center">
                                                <div class="empty-state">
                                                    <i class="fas fa-history"></i>
                                                    <h4>No Trade History</h4>
                                                    <p>Your buy/sell transactions will appear here</p>
                                                </div>
                                            </td>
                                        </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Transaction Details Tab -->
                    <div class="tab-pane fade" id="details" role="tabpanel">
                        <div class="table-wrapper">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Wallet</th>
                                        <th>Coin</th>
                                        <th>Amount</th>
                                        <th>Purchase Price</th>
                                        <th>Current Price</th>
                                        <th>Profit/Loss</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if transactions %}
                                        {% for transaction in transactions %}
                                    <tr>
                                        <td><strong>Wallet {{ transaction.wallet_id }}</strong></td>
                                        <td><strong>{{ transaction.coin_id.upper() }}</strong></td>
                                        <td>{{ transaction.amount | round(8) }}</td>
                                        <td>${{ transaction.price | round(2) }}</td>
                                        <td><strong>${{ current_prices.get(transaction.coin_id, 0) | round(2) }}</strong></td>
                                        <td class="{% if ((current_prices.get(transaction.coin_id, 0) - transaction.price) * transaction.amount) > 0 %}price-positive{% else %}price-negative{% endif %}">
                                            {% if ((current_prices.get(transaction.coin_id, 0) - transaction.price) * transaction.amount) > 0 %}
                                                <i class="fas fa-arrow-up"></i>
                                            {% else %}
                                                <i class="fas fa-arrow-down"></i>
                                            {% endif %}
                                            ${{ ((current_prices.get(transaction.coin_id, 0) - transaction.price) * transaction.amount) | round(2) }}
                                        </td>
                                        <td>
                                            <form method="POST" action="{{ url_for('trade') }}" class="mb-2">
                                                <input type="hidden" name="coin_id" value="{{ transaction.coin_id }}">
                                                <input type="hidden" name="current_price" value="{{ current_prices.get(transaction.coin_id, 0) }}">
                                                <input type="hidden" name="wallet_id" value="{{ transaction.wallet_id }}">
                                                <input type="hidden" name="source" value="portfolio">
                                                <input type="hidden" name="buy_transaction_id" value="{{ transaction.buy_transaction_id }}">
                                                <div class="input-group input-group-sm">
                                                    <input type="number" class="form-control" name="amount" placeholder="Amount" step="0.00000001" required>
                                                    <button type="submit" name="action" value="sell" class="btn btn-sm btn-secondary">Sell</button>
                                                </div>
                                            </form>
                                            <button class="btn btn-sm btn-info" onclick="showPortfolioChart('{{ transaction.coin_id }}'); return false;">
                                                <i class="fas fa-chart-line"></i> View Chart
                                            </button>
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="7" class="text-center">
                                        <div class="empty-state">
                                            <i class="fas fa-wallet"></i>
                                            <h4>No Holdings Yet</h4>
                                            <p>Add coins to your portfolio to start tracking</p>
                                        </div>
                                    </td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="chart-container" id="portfolioChartContainer" style="opacity: 0; transition: opacity 0.3s;">
                <canvas id="portfolioChart"></canvas>
            </div>
            
            <script>
                (function() {
                    let portfolioChartInstance = null;
                    
                    window.showPortfolioChart = function(coinId) {
                        const chartContainer = document.getElementById('portfolioChartContainer');
                        chartContainer.style.opacity = '0.5';
                        
                        fetch(`/historical/${coinId}`)
                            .then(response => response.json())
                            .then(data => {
                                if (data.error) {
                                    alert(data.error);
                                    chartContainer.style.opacity = '1';
                                    return;
                                }
                                
                                const ctx = document.getElementById('portfolioChart').getContext('2d');
                                
                                if (portfolioChartInstance) {
                                    portfolioChartInstance.destroy();
                                }
                                
                                portfolioChartInstance = new Chart(ctx, {
                                    type: 'line',
                                    data: {
                                        labels: data.dates,
                                        datasets: [
                                            {
                                                label: `${coinId.toUpperCase()} Price (USD)`,
                                                data: data.prices,
                                                borderColor: '#2563eb',
                                                backgroundColor: 'rgba(37, 99, 235, 0.1)',
                                                borderWidth: 2,
                                                tension: 0.4,
                                                yAxisID: 'y-price',
                                                fill: true,
                                                pointRadius: 0,
                                                pointHoverRadius: 6,
                                                pointHoverBackgroundColor: '#2563eb',
                                                pointHoverBorderColor: '#fff',
                                                pointHoverBorderWidth: 2
                                            },
                                            {
                                                label: `${coinId.toUpperCase()} Volume (USD)`,
                                                data: data.volumes,
                                                borderColor: '#10b981',
                                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                                borderWidth: 2,
                                                tension: 0.4,
                                                yAxisID: 'y-volume',
                                                fill: true,
                                                pointRadius: 0,
                                                pointHoverRadius: 6,
                                                pointHoverBackgroundColor: '#10b981',
                                                pointHoverBorderColor: '#fff',
                                                pointHoverBorderWidth: 2
                                            },
                                            {
                                                label: `${coinId.toUpperCase()} Market Cap (USD)`,
                                                data: data.market_caps,
                                                borderColor: '#ef4444',
                                                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                                borderWidth: 2,
                                                tension: 0.4,
                                                yAxisID: 'y-market-cap',
                                                fill: true,
                                                pointRadius: 0,
                                                pointHoverRadius: 6,
                                                pointHoverBackgroundColor: '#ef4444',
                                                pointHoverBorderColor: '#fff',
                                                pointHoverBorderWidth: 2
                                            }
                                        ]
                                    },
                                    options: {
                                        responsive: true,
                                        maintainAspectRatio: false,
                                        interaction: {
                                            mode: 'index',
                                            intersect: false
                                        },
                                        plugins: {
                                            legend: {
                                                display: true,
                                                position: 'top',
                                                labels: {
                                                    usePointStyle: true,
                                                    padding: 20,
                                                    font: {
                                                        size: 13,
                                                        weight: '600'
                                                    }
                                                }
                                            },
                                            tooltip: {
                                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                                padding: 12,
                                                titleFont: {
                                                    size: 14,
                                                    weight: 'bold'
                                                },
                                                bodyFont: {
                                                    size: 13
                                                },
                                                cornerRadius: 8
                                            }
                                        },
                                        scales: {
                                            x: {
                                                display: true,
                                                title: {
                                                    display: true,
                                                    text: 'Date',
                                                    font: {
                                                        size: 14,
                                                        weight: 'bold'
                                                    },
                                                    color: '#64748b'
                                                },
                                                grid: {
                                                    display: false
                                                },
                                                ticks: {
                                                    color: '#64748b',
                                                    font: {
                                                        size: 12
                                                    }
                                                }
                                            },
                                            'y-price': {
                                                type: 'linear',
                                                display: true,
                                                position: 'left',
                                                title: {
                                                    display: true,
                                                    text: 'Price (USD)',
                                                    font: {
                                                        size: 14,
                                                        weight: 'bold'
                                                    },
                                                    color: '#2563eb'
                                                },
                                                grid: {
                                                    color: 'rgba(0, 0, 0, 0.05)'
                                                },
                                                ticks: {
                                                    color: '#2563eb',
                                                    font: {
                                                        size: 12,
                                                        weight: '600'
                                                    }
                                                }
                                            },
                                            'y-volume': {
                                                type: 'linear',
                                                display: true,
                                                position: 'right',
                                                title: {
                                                    display: true,
                                                    text: 'Volume (USD)',
                                                    font: {
                                                        size: 14,
                                                        weight: 'bold'
                                                    },
                                                    color: '#10b981'
                                                },
                                                grid: {
                                                    drawOnChartArea: false
                                                },
                                                ticks: {
                                                    color: '#10b981',
                                                    font: {
                                                        size: 12,
                                                        weight: '600'
                                                    }
                                                }
                                            },
                                            'y-market-cap': {
                                                type: 'linear',
                                                display: false,
                                                position: 'right'
                                            }
                                        }
                                    }
                                });
                                
                                chartContainer.style.opacity = '1';
                            })
                            .catch(error => {
                                chartContainer.style.opacity = '1';
                                console.error('Error fetching chart data:', error);
                                alert('Failed to load chart data. Please try again.');
                            });
                    };
                })();
            </script>
            
            <div class="dashboard-card">
                <h3><i class="fas fa-shield-alt"></i>Risk Metrics</h3>
                <div class="table-wrapper">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Coin</th>
                                <th>Sharpe Ratio</th>
                                <th>Volatility (Annualized)</th>
                                <th>Max Drawdown</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if risk_metrics %}
                                {% for coin_id, metrics in risk_metrics.items() %}
                                    <tr>
                                        <td><strong>{{ coin_id.upper() }}</strong></td>
                                        <td>{{ metrics.sharpe_ratio }}</td>
                                        <td>{{ metrics.volatility }}</td>
                                        <td class="price-negative">{{ metrics.max_drawdown }}</td>
                                    </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="4" class="text-center">
                                        <div class="empty-state">
                                            <i class="fas fa-chart-bar"></i>
                                            <h4>No Risk Metrics</h4>
                                            <p>Add holdings to view risk analysis</p>
                                        </div>
                                    </td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="dashboard-card">
                <h3><i class="fas fa-project-diagram"></i>Asset Correlation Matrix</h3>
                <div class="chart-container" id="correlationChartContainer" style="height: 400px;">
                    <canvas id="correlationChart"></canvas>
                </div>
                <script>
                    fetch('/correlation_matrix')
                        .then(response => response.json())
                        .then(data => {
                            if (data.matrix && data.matrix.length > 0) {
                                const ctx = document.getElementById('correlationChart').getContext('2d');
                                new Chart(ctx, {
                                    type: 'matrix',
                                    data: {
                                        datasets: [{
                                            label: 'Correlation Matrix',
                                            data: data.matrix.flatMap((row, i) => 
                                                row.map((value, j) => ({
                                                    x: j,
                                                    y: i,
                                                    v: Math.round(value * 100) / 100
                                                }))
                                            ),
                                            backgroundColor: (ctx) => {
                                                const value = ctx.dataset.data[ctx.dataIndex].v;
                                                const intensity = Math.abs(value);
                                                if (value >= 0) {
                                                    return `rgba(37, 99, 235, ${intensity})`;
                                                } else {
                                                    return `rgba(239, 68, 68, ${intensity})`;
                                                }
                                            },
                                            borderColor: 'rgba(0, 0, 0, 0.1)',
                                            borderWidth: 1,
                                            width: ({ chart }) => (chart.chartArea.width / data.labels.length) - 2,
                                            height: ({ chart }) => (chart.chartArea.height / data.labels.length) - 2
                                        }]
                                    },
                                    options: {
                                        responsive: true,
                                        maintainAspectRatio: false,
                                        plugins: {
                                            legend: { display: false },
                                            tooltip: {
                                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                                padding: 12,
                                                titleFont: {
                                                    size: 14,
                                                    weight: 'bold'
                                                },
                                                bodyFont: {
                                                    size: 13
                                                },
                                                cornerRadius: 8,
                                                callbacks: {
                                                    title: () => 'Correlation',
                                                    label: (ctx) => {
                                                        const xLabel = data.labels[ctx.raw.x];
                                                        const yLabel = data.labels[ctx.raw.y];
                                                        const value = ctx.raw.v;
                                                        return `${xLabel} vs ${yLabel}: ${value}`;
                                                    }
                                                }
                                            }
                                        },
                                        scales: {
                                            x: {
                                                ticks: {
                                                    callback: (value) => data.labels[value]?.toUpperCase() || '',
                                                    maxRotation: 45,
                                                    minRotation: 45,
                                                    color: '#64748b',
                                                    font: {
                                                        size: 11,
                                                        weight: '600'
                                                    }
                                                },
                                                grid: { display: false }
                                            },
                                            y: {
                                                ticks: { 
                                                    callback: (value) => data.labels[value]?.toUpperCase() || '',
                                                    color: '#64748b',
                                                    font: {
                                                        size: 11,
                                                        weight: '600'
                                                    }
                                                },
                                                grid: { display: false }
                                            }
                                        }
                                    }
                                });
                            }
                        })
                        .catch(error => {
                            console.error('Error loading correlation matrix:', error);
                        });
                </script>
            </div>
            
            <div class="dashboard-card">
                <h3><i class="fas fa-history"></i>Archived Transactions (Sold Coins)</h3>
                <div class="table-wrapper">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Wallet</th>
                                <th>Coin</th>
                                <th>Amount</th>
                                <th>Purchase Price</th>
                                <th>Sold Price</th>
                                <th>Profit/Loss</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if sold_transactions %}
                                {% for transaction in sold_transactions %}
                                    <tr>
                                        <td><strong>Wallet {{ transaction.wallet_id }}</strong></td>
                                        <td><strong>{{ transaction.coin_id.upper() }}</strong></td>
                                        <td>{{ transaction.amount | round(8) }}</td>
                                        <td>${{ transaction.price | round(2) }}</td>
                                        <td>${{ transaction.sold_price | round(2) }}</td>
                                        <td class="{% if transaction.profit|float > 0 %}price-positive{% else %}price-negative{% endif %}">
                                            {% if transaction.profit|float > 0 %}
                                                <i class="fas fa-arrow-up"></i>
                                            {% else %}
                                                <i class="fas fa-arrow-down"></i>
                                            {% endif %}
                                            ${{ transaction.profit }}
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="6" class="text-center">
                                        <div class="empty-state">
                                            <i class="fas fa-inbox"></i>
                                            <h4>No Archived Transactions</h4>
                                            <p>Sold transactions will appear here</p>
                                        </div>
                                    </td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
                {% if total_profit is defined and sold_transactions %}
                    <div style="padding: 16px; background: var(--bg-secondary); border-radius: 8px; margin-top: 16px;">
                        <strong style="font-size: 16px;">Total Profit/Loss from Sold Coins:</strong> 
                        <span style="font-size: 18px; font-weight: 700;" class="{% if total_profit|float > 0 %}price-positive{% else %}price-negative{% endif %}">
                            ${{ total_profit }}
                        </span>
                    </div>
                {% endif %}
            </div>
        </div>

    {% elif section == 'watchlist' %}
        <div class="container">
            <nav class="navbar navbar-expand-lg">
                <a class="navbar-brand" href="{{ url_for('dashboard') }}"><i class="fas fa-arrow-left"></i>CoinPrep</a>
                <div class="navbar-nav ms-auto">
                    <a class="nav-link" href="{{ url_for('live_market') }}"><i class="fas fa-chart-line"></i>Live Market</a>
                    <a class="nav-link" href="{{ url_for('portfolio') }}"><i class="fas fa-wallet"></i>Portfolio</a>
                    <a class="nav-link" href="{{ url_for('alerts') }}"><i class="fas fa-bell"></i>Price Alerts</a>
                    <a class="nav-link" href="{{ url_for('risk_quiz') }}"><i class="fas fa-question-circle"></i>Risk Quiz</a>
                    <a class="nav-link" href="{{ url_for('achievements') }}"><i class="fas fa-trophy"></i>Achievements</a>
                    <a class="nav-link" href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i>Logout</a>
                </div>
            </nav>
            
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div id="notificationsContainer">
                        {% for category, message in messages %}
                            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                                <i class="fas fa-info-circle"></i>
                                <div>
                                    <strong>{{ category|capitalize }}</strong>
                                    <p style="margin: 0;">{{ message }}</p>
                                </div>
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}
            
            <div class="dashboard-card">
                <h3><i class="fas fa-plus-circle"></i>Add Coin to Watchlist</h3>
                <form method="POST" action="{{ url_for('watchlist') }}">
                    <div class="row g-3">
                        <div class="col-md-10">
                        <div class="col-md-10">
                            {% if available_coins and available_coins|length > 0 %}
                                <select name="coin_id" class="form-select" required>
                                    <option value="" disabled selected>Select a cryptocurrency</option>
                                    {% for coin in available_coins %}
                                        <option value="{{ coin.id }}">{{ coin.name }} ({{ coin.symbol.upper() }})</option>
                                    {% endfor %}
                                </select>
                            {% else %}
                                <input type="text" class="form-control" name="coin_id" placeholder="Enter Coin ID (e.g., bitcoin, ethereum)" required>
                            {% endif %}
                        </div>
                        <div class="col-md-2">
                            <input type="hidden" name="action" value="add">
                            <button type="submit" class="btn btn-primary w-100"><i class="fas fa-star"></i> Add to Watchlist</button>
                        </div>
                    </div>
                    {% if not available_coins or available_coins|length == 0 %}
                        <div class="alert" style="margin-top: 12px; padding: 10px; background: #fef3c7; border: 1px solid #fbbf24; border-radius: 6px; color: #92400e; font-size: 13px;">
                            <i class="fas fa-exclamation-triangle"></i> No coins available in dropdown. Please enter a Coin ID manually.
                        </div>
                    {% endif %}
                </form>
            </div>
            
            <div class="dashboard-card">
                <h3><i class="fas fa-star"></i>Watched Coins</h3>
                <div class="table-wrapper">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Coin</th>
                                <th>Symbol</th>
                                <th>Current Price</th>
                                <th>24h Change</th>
                                <th>Market Cap</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if coins %}
                                {% for coin in coins %}
                                    <tr>
                                        <td><strong>{{ coin.name }}</strong></td>
                                        <td>{{ coin.symbol.upper() }}</td>
                                        <td><strong>${{ coin.current_price | round(2) if coin.current_price != 'N/A' else 'N/A' }}</strong></td>
                                        <td class="{% if coin.price_change_percentage_24h != 'N/A' and coin.price_change_percentage_24h > 0 %}price-positive{% elif coin.price_change_percentage_24h != 'N/A' %}price-negative{% endif %}">
                                            {% if coin.price_change_percentage_24h != 'N/A' %}
                                                {% if coin.price_change_percentage_24h > 0 %}
                                                    <i class="fas fa-arrow-up"></i>
                                                {% else %}
                                                    <i class="fas fa-arrow-down"></i>
                                                {% endif %}
                                                {{ coin.price_change_percentage_24h | round(2) }}%
                                            {% else %}
                                                N/A
                                            {% endif %}
                                        </td>
                                        <td>{% if coin.market_cap != 'N/A' %}${{ "{:,.0f}".format(coin.market_cap) }}{% else %}N/A{% endif %}</td>
                                        <td>
                                            <form method="POST" action="{{ url_for('watchlist') }}" style="display: inline-block; margin-right: 8px;">
                                                <input type="hidden" name="coin_id" value="{{ coin.id }}">
                                                <input type="hidden" name="action" value="remove">
                                                <button type="submit" class="btn btn-sm btn-secondary"><i class="fas fa-trash"></i> Remove</button>
                                            </form>
                                            <button class="btn btn-sm btn-info" onclick="showWatchlistChart('{{ coin.id }}'); return false;">
                                                <i class="fas fa-chart-line"></i> View Chart
                                            </button>
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="6" class="text-center">
                                        <div class="empty-state">
                                            <i class="fas fa-star"></i>
                                            <h4>No Watched Coins</h4>
                                            <p>Add cryptocurrencies to track their performance</p>
                                        </div>
                                    </td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="chart-container" id="watchlistChartContainer" style="opacity: 0; transition: opacity 0.3s;">
                <canvas id="watchlistChart"></canvas>
            </div>
            
            <script>
                (function() {
                    let watchlistChartInstance = null;
                    
                    window.showWatchlistChart = function(coinId) {
                        const chartContainer = document.getElementById('watchlistChartContainer');
                        chartContainer.style.opacity = '0.5';
                        
                        fetch(`/historical/${coinId}`)
                            .then(response => response.json())
                            .then(data => {
                                if (data.error) {
                                    alert(data.error);
                                    chartContainer.style.opacity = '1';
                                    return;
                                }
                                
                                const ctx = document.getElementById('watchlistChart').getContext('2d');
                                
                                if (watchlistChartInstance) {
                                    watchlistChartInstance.destroy();
                                }
                                
                                watchlistChartInstance = new Chart(ctx, {
                                    type: 'line',
                                    data: {
                                        labels: data.dates,
                                        datasets: [
                                            {
                                                label: `${coinId.toUpperCase()} Price (USD)`,
                                                data: data.prices,
                                                borderColor: '#2563eb',
                                                backgroundColor: 'rgba(37, 99, 235, 0.1)',
                                                borderWidth: 2,
                                                tension: 0.4,
                                                yAxisID: 'y-price',
                                                fill: true,
                                                pointRadius: 0,
                                                pointHoverRadius: 6,
                                                pointHoverBackgroundColor: '#2563eb',
                                                pointHoverBorderColor: '#fff',
                                                pointHoverBorderWidth: 2
                                            },
                                            {
                                                label: `${coinId.toUpperCase()} Volume (USD)`,
                                                data: data.volumes,
                                                borderColor: '#10b981',
                                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                                borderWidth: 2,
                                                tension: 0.4,
                                                yAxisID: 'y-volume',
                                                fill: true,
                                                pointRadius: 0,
                                                pointHoverRadius: 6,
                                                pointHoverBackgroundColor: '#10b981',
                                                pointHoverBorderColor: '#fff',
                                                pointHoverBorderWidth: 2
                                            },
                                            {
                                                label: `${coinId.toUpperCase()} Market Cap (USD)`,
                                                data: data.market_caps,
                                                borderColor: '#ef4444',
                                                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                                borderWidth: 2,
                                                tension: 0.4,
                                                yAxisID: 'y-market-cap',
                                                fill: true,
                                                pointRadius: 0,
                                                pointHoverRadius: 6,
                                                pointHoverBackgroundColor: '#ef4444',
                                                pointHoverBorderColor: '#fff',
                                                pointHoverBorderWidth: 2
                                            }
                                        ]
                                    },
                                    options: {
                                        responsive: true,
                                        maintainAspectRatio: false,
                                        interaction: {
                                            mode: 'index',
                                            intersect: false
                                        },
                                        plugins: {
                                            legend: {
                                                display: true,
                                                position: 'top',
                                                labels: {
                                                    usePointStyle: true,
                                                    padding: 20,
                                                    font: {
                                                        size: 13,
                                                        weight: '600'
                                                    }
                                                }
                                            },
                                            tooltip: {
                                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                                padding: 12,
                                                titleFont: {
                                                    size: 14,
                                                    weight: 'bold'
                                                },
                                                bodyFont: {
                                                    size: 13
                                                },
                                                cornerRadius: 8
                                            }
                                        },
                                        scales: {
                                            x: {
                                                display: true,
                                                title: {
                                                    display: true,
                                                    text: 'Date',
                                                    font: {
                                                        size: 14,
                                                        weight: 'bold'
                                                    },
                                                    color: '#64748b'
                                                },
                                                grid: {
                                                    display: false
                                                },
                                                ticks: {
                                                    color: '#64748b',
                                                    font: {
                                                        size: 12
                                                    }
                                                }
                                            },
                                            'y-price': {
                                                type: 'linear',
                                                display: true,
                                                position: 'left',
                                                title: {
                                                    display: true,
                                                    text: 'Price (USD)',
                                                    font: {
                                                        size: 14,
                                                        weight: 'bold'
                                                    },
                                                    color: '#2563eb'
                                                },
                                                grid: {
                                                    color: 'rgba(0, 0, 0, 0.05)'
                                                },
                                                ticks: {
                                                    color: '#2563eb',
                                                    font: {
                                                        size: 12,
                                                        weight: '600'
                                                    }
                                                }
                                            },
                                            'y-volume': {
                                                type: 'linear',
                                                display: true,
                                                position: 'right',
                                                title: {
                                                    display: true,
                                                    text: 'Volume (USD)',
                                                    font: {
                                                        size: 14,
                                                        weight: 'bold'
                                                    },
                                                    color: '#10b981'
                                                },
                                                grid: {
                                                    drawOnChartArea: false
                                                },
                                                ticks: {
                                                    color: '#10b981',
                                                    font: {
                                                        size: 12,
                                                        weight: '600'
                                                    }
                                                }
                                            },
                                            'y-market-cap': {
                                                type: 'linear',
                                                display: false,
                                                position: 'right'
                                            }
                                        }
                                    }
                                });
                                
                                chartContainer.style.opacity = '1';
                            })
                            .catch(error => {
                                chartContainer.style.opacity = '1';
                                console.error('Error fetching chart data:', error);
                                alert('Failed to load chart data. Please try again.');
                            });
                    };
                })();
            </script>
        </div>

    {% elif section == 'alerts' %}
        <div class="container">
            <nav class="navbar navbar-expand-lg">
                <a class="navbar-brand" href="{{ url_for('dashboard') }}"><i class="fas fa-arrow-left"></i>CoinPrep</a>
                <div class="navbar-nav ms-auto">
                    <a class="nav-link" href="{{ url_for('live_market') }}"><i class="fas fa-chart-line"></i>Live Market</a>
                    <a class="nav-link" href="{{ url_for('portfolio') }}"><i class="fas fa-wallet"></i>Portfolio</a>
                    <a class="nav-link" href="{{ url_for('watchlist') }}"><i class="fas fa-star"></i>Watchlist</a>
                    <a class="nav-link" href="{{ url_for('risk_quiz') }}"><i class="fas fa-question-circle"></i>Risk Quiz</a>
                    <a class="nav-link" href="{{ url_for('achievements') }}"><i class="fas fa-trophy"></i>Achievements</a>
                    <a class="nav-link" href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i>Logout</a>
                </div>
            </nav>
            
            <div class="dashboard-card">
                <h3><i class="fas fa-bell"></i>Set New Price Alert</h3>
                <form method="POST" action="{{ url_for('alerts') }}">
                    <div class="row g-3">
                    <div class="row g-3">
                        <div class="col-md-3">
                            {% if available_coins and available_coins|length > 0 %}
                                <select name="coin_id" class="form-select" required>
                                    <option value="" disabled selected>Select cryptocurrency</option>
                                    {% for coin in available_coins %}
                                        <option value="{{ coin.id }}">{{ coin.name }} ({{ coin.symbol.upper() }})</option>
                                    {% endfor %}
                                </select>
                            {% else %}
                                <input type="text" class="form-control" name="coin_id" placeholder="Enter Coin ID" required>
                            {% endif %}
                        </div>
                        <div class="col-md-2">
                            <input type="number" class="form-control" name="target_price" placeholder="Target Price (USD)" step="0.01" required>
                        </div>
                        <div class="col-md-2">
                            <select name="alert_type" class="form-select" required>
                                <option value="above">Above</option>
                                <option value="below">Below</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select name="order_type" class="form-select" required>
                                <option value="limit">Limit Order</option>
                                <option value="market">Market Order</option>
                                <option value="stop">Stop Order</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button type="submit" class="btn btn-primary w-100"><i class="fas fa-bell"></i> Set Alert</button>
                        </div>
                    </div>
                </form>
            </div>
            
            <div class="dashboard-card">
                <h3><i class="fas fa-list"></i>Your Price Alerts</h3>
                <div class="table-wrapper">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Coin</th>
                                <th>Target Price</th>
                                <th>Alert Type</th>
                                <th>Order Type</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if alerts %}
                                {% for alert in alerts %}
                                    <tr>
                                        <td><strong>{{ alert.coin_id.upper() }}</strong></td>
                                        <td><strong>${{ alert.target_price | round(2) }}</strong></td>
                                        <td>
                                            <span style="display: inline-flex; align-items: center; padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: 600; 
                                                {% if alert.alert_type == 'above' %}background: rgba(16, 185, 129, 0.1); color: #059669;{% else %}background: rgba(239, 68, 68, 0.1); color: #dc2626;{% endif %}">
                                                {% if alert.alert_type == 'above' %}
                                                    <i class="fas fa-arrow-up" style="margin-right: 4px;"></i>Above
                                                {% else %}
                                                    <i class="fas fa-arrow-down" style="margin-right: 4px;"></i>Below
                                                {% endif %}
                                            </span>
                                        </td>
                                        <td><span style="text-transform: capitalize;">{{ alert.order_type }}</span></td>
                                        <td>
                                            {% if alert.status == 'Triggered' %}
                                                <span style="display: inline-flex; align-items: center; padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: 600; background: rgba(16, 185, 129, 0.1); color: #059669;">
                                                    <i class="fas fa-check-circle" style="margin-right: 4px;"></i>Triggered
                                                </span>
                                            {% else %}
                                                <span style="display: inline-flex; align-items: center; padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: 600; background: rgba(245, 158, 11, 0.1); color: #d97706;">
                                                    <i class="fas fa-clock" style="margin-right: 4px;"></i>Pending
                                                </span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <form method="POST" action="{{ url_for('remove_alert', alert_id=alert.id) }}" style="display: inline-block;">
                                                <button type="submit" class="btn btn-sm btn-secondary"><i class="fas fa-trash"></i> Remove</button>
                                            </form>
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td colspan="6" class="text-center">
                                        <div class="empty-state">
                                            <i class="fas fa-bell-slash"></i>
                                            <h4>No Active Alerts</h4>
                                            <p>Set price alerts to get notified when cryptocurrencies reach your target price</p>
                                        </div>
                                    </td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
                
                <div style="padding: 16px; background: var(--bg-secondary); border-radius: 8px; margin-top: 16px;">
                    <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: var(--text-primary);"><i class="fas fa-info-circle"></i> How Alerts Work</h4>
                    <ul style="margin: 0; padding-left: 20px; font-size: 13px; color: var(--text-secondary); line-height: 1.6;">
                        <li>Alerts are checked every <strong>5 minutes</strong> automatically</li>
                        <li>You'll receive an <strong>email notification</strong> when your target price is reached</li>
                        <li><strong>"Above"</strong> alerts trigger when price rises to or above your target</li>
                        <li><strong>"Below"</strong> alerts trigger when price falls to or below your target</li>
                        <li>Once triggered, alerts are marked as "Triggered" and won't notify again</li>
                        <li>Remove old alerts and set new ones to continue monitoring</li>
                    </ul>
                </div>
            </div>
        </div>

    {% elif section == 'risk_quiz' %}
        <div class="container">
            <nav class="navbar navbar-expand-lg navbar-light bg-light mb-4">
                <a class="navbar-brand" href="{{ url_for('dashboard') }}">Back to Dashboard</a>
                <div class="navbar-nav">
                    <a class="nav-link" href="{{ url_for('live_market') }}">Live Market</a>
                    <a class="nav-link" href="{{ url_for('portfolio') }}">Portfolio</a>
                    <a class="nav-link" href="{{ url_for('watchlist') }}">Watchlist</a>
                    <a class="nav-link" href="{{ url_for('alerts') }}">Price Alerts</a>
                    <a class="nav-link active" href="{{ url_for('risk_quiz') }}">Risk Quiz</a>
                    <a class="nav-link" href="{{ url_for('achievements') }}">Achievements</a>
                    <a class="nav-link" href="{{ url_for('logout') }}">Logout</a>
                </div>
            </nav>
            
            <div class="container mt-4">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h2 class="mb-0">Investment Risk Tolerance Assessment</h2>
                    </div>
                    <div class="card-body">
                        {% with messages = get_flashed_messages(with_categories=true) %}
                            {% if messages %}
                                {% for category, message in messages %}
                                    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                                        {{ message }}
                                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                    </div>
                                {% endfor %}
                            {% endif %}
                        {% endwith %}
                        
                        <div class="alert alert-info">
                            <h5>About This Assessment</h5>
                            <p>This quiz will help determine your investment risk tolerance by evaluating your financial situation, investment goals, and comfort with market fluctuations. Your answers will help us recommend an investment strategy that matches your risk profile.</p>
                        </div>
                        
                        <form method="POST" action="{{ url_for('risk_quiz') }}" class="mt-4">
                            {% for question in questions %}
                                <div class="card mb-4">
                                    <div class="card-header">
                                        <h5 class="mb-0">
                                            {{ loop.index }}. {{ question.text }}
                                            <small class="text-muted ms-2" data-bs-toggle="tooltip" title="{{ question.explanation }}">
                                                <i class="bi bi-info-circle">â„¹ï¸</i>
                                            </small>
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        {% for option in question.options %}
                                            <div class="form-check mb-2">
                                                <input class="form-check-input" type="radio" name="{{ question.id }}" id="{{ question.id }}_{{ loop.index }}" value="{{ option.value }}" required>
                                                <label class="form-check-label d-flex align-items-center" for="{{ question.id }}_{{ loop.index }}">
                                                    {{ option.text }}
                                                    <small class="text-muted ms-2" data-bs-toggle="tooltip" title="{{ option.explanation }}">
                                                        <i class="bi bi-info-circle">â„¹ï¸</i>
                                                    </small>
                                                </label>
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            {% endfor %}
                            
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                                <button type="reset" class="btn btn-outline-secondary me-md-2">Reset</button>
                                <button type="submit" class="btn btn-primary">Submit Assessment</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <style>
                .form-check-input:checked + .form-check-label {
                    font-weight: 500;
                    color: #0d6efd;
                }
                .card {
                    border: none;
                    border-radius: 10px;
                }
                .card-header {
                    border-radius: 10px 10px 0 0 !important;
                }
                .btn-primary {
                    padding: 0.5rem 2rem;
                    border-radius: 5px;
                }
                [data-bs-toggle="tooltip"] {
                    cursor: help;
                    text-decoration: none;
                }
            </style>
            
            <script>
                // Initialize tooltips
                document.addEventListener('DOMContentLoaded', function() {
                    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
                    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                        return new bootstrap.Tooltip(tooltipTriggerEl);
                    });
                });
            </script>
            </form>
        </div>
            
    {% elif section == 'risk_quiz_result' %}
        <div class="container">
            <nav class="navbar navbar-expand-lg navbar-light bg-light mb-4">
                <a class="navbar-brand" href="{{ url_for('dashboard') }}">Back to Dashboard</a>
                <div class="navbar-nav">
                    <a class="nav-link" href="{{ url_for('live_market') }}">Live Market</a>
                    <a class="nav-link" href="{{ url_for('portfolio') }}">Portfolio</a>
                    <a class="nav-link" href="{{ url_for('watchlist') }}">Watchlist</a>
                    <a class="nav-link" href="{{ url_for('alerts') }}">Price Alerts</a>
                    <a class="nav-link active" href="{{ url_for('risk_quiz') }}">Risk Quiz</a>
                    <a class="nav-link" href="{{ url_for('achievements') }}">Achievements</a>
                    <a class="nav-link" href="{{ url_for('logout') }}">Logout</a>
                </div>
            </nav>
            
            <div class="container mt-4">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h2 class="mb-0">Your Risk Profile Assessment</h2>
                    </div>
                    <div class="card-body">
                        <div class="text-center mb-5">
                            <h3 class="mb-3">Your Risk Tolerance: <strong>{{ risk_level }}</strong></h3>
                            
                            <!-- Risk Meter -->
                            <div class="progress mb-4" style="height: 30px; border-radius: 15px; background-color: #e9ecef;">
                                <div class="progress-bar bg-danger" role="progressbar" style="width: {{ risk_percent }}%" 
                                     aria-valuenow="{{ risk_percent }}" aria-valuemin="0" aria-valuemax="100">
                                    {{ risk_percent }}%
                                </div>
                            </div>
                            
                            <div class="row
                                {% if risk_percent <= 20 %}
                                    text-danger
                                {% elif risk_percent <= 40 %}
                                    text-warning
                                {% elif risk_percent <= 60 %}
                                    text-primary
                                {% elif risk_percent <= 80 %}
                                    text-info
                                {% else %}
                                    text-success
                                {% endif %}
                                mb-4">
                                <div class="col">
                                    <i class="bi bi-shield-lock" style="font-size: 3rem;"></i>
                                    <div>Conservative</div>
                                </div>
                                <div class="col">
                                    <i class="bi bi-shield" style="font-size: 3rem;"></i>
                                    <div>Moderate</div>
                                </div>
                                <div class="col">
                                    <i class="bi bi-shield-check" style="font-size: 3rem;"></i>
                                    <div>Balanced</div>
                                </div>
                                <div class="col">
                                    <i class="bi bi-shield-plus" style="font-size: 3rem;"></i>
                                    <div>Growth</div>
                                </div>
                                <div class="col">
                                    <i class="bi bi-shield-shaded" style="font-size: 3rem;"></i>
                                    <div>Aggressive</div>
                                </div>
                            </div>
                            
                            <div class="alert alert-info">
                                <h5>What This Means</h5>
                                <p>Based on your responses, your risk tolerance score is <strong>{{ score }} out of {{ max_score }}</strong>. This places you in the <strong>{{ risk_level }}</strong> category for investing. Here's what that means for your investment strategy:</p>
                                {{ recommendation|safe }}
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <div class="card h-100">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0">Suggested Asset Allocation</h5>
                                    </div>
                                    <div class="card-body">
                                        <canvas id="allocationChart" height="300"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card h-100">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0">Investment Tips</h5>
                                    </div>
                                    <div class="card-body">
                                        <ul class="list-group list-group-flush">
                                            <li class="list-group-item">
                                                <i class="bi bi-check-circle-fill text-success me-2"></i>
                                                Review your portfolio at least quarterly
                                            </li>
                                            <li class="list-group-item">
                                                <i class="bi bi-check-circle-fill text-success me-2"></i>
                                                Consider dollar-cost averaging for new investments
                                            </li>
                                            <li class="list-group-item">
                                                <i class="bi bi-check-circle-fill text-success me-2"></i>
                                                Rebalance your portfolio when allocations shift by more than 5%
                                            </li>
                                            <li class="list-group-item">
                                                <i class="bi bi-check-circle-fill text-success me-2"></i>
                                                Stay diversified across different asset classes
                                            </li>
                                            <li class="list-group-item">
                                                <i class="bi bi-check-circle-fill text-success me-2"></i>
                                                Consider consulting with a financial advisor for personalized advice
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <button class="btn btn-outline-primary" onclick="window.print()">
                                <i class="bi bi-printer"></i> Print Your Results
                            </button>
                            <a href="{{ url_for('dashboard') }}" class="btn btn-primary ms-2">
                                <i class="bi bi-house"></i> Back to Dashboard
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <script>
                // Asset allocation chart
                document.addEventListener('DOMContentLoaded', function() {
                    const ctx = document.getElementById('allocationChart').getContext('2d');
                    
                    // Dynamic allocation based on risk level
                    let data = [];
                    let labels = [];
                    let backgroundColors = [];
                    
                    if ({{ risk_percent }} <= 20) {
                        // Conservative
                        data = [60, 30, 10];
                        labels = ['Bonds & Fixed Income', 'Large Cap Stocks', 'Cash & Equivalents'];
                        backgroundColors = ['#4e73df', '#1cc88a', '#36b9cc'];
                    } else if ({{ risk_percent }} <= 40) {
                        // Moderately Conservative
                        data = [45, 40, 10, 5];
                        labels = ['Bonds & Fixed Income', 'Large Cap Stocks', 'International Stocks', 'Cash'];
                        backgroundColors = ['#4e73df', '#1cc88a', '#f6c23e', '#36b9cc'];
                    } else if ({{ risk_percent }} <= 60) {
                        // Balanced
                        data = [40, 35, 15, 10];
                        labels = ['Large Cap Stocks', 'Bonds', 'International Stocks', 'Small/Mid Cap'];
                        backgroundColors = ['#1cc88a', '#4e73df', '#f6c23e', '#e74a3b'];
                    } else if ({{ risk_percent }} <= 80) {
                        // Growth-Oriented
                        data = [50, 20, 15, 10, 5];
                        labels = ['Large Cap Growth', 'International Stocks', 'Small/Mid Cap', 'Emerging Markets', 'Bonds'];
                        backgroundColors = ['#1cc88a', '#f6c23e', '#e74a3b', '#5a5c69', '#4e73df'];
                    } else {
                        // Aggressive
                        data = [40, 25, 20, 10, 5];
                        labels = ['Large Cap Growth', 'Small/Mid Cap', 'International Growth', 'Emerging Markets', 'Sector-Specific'];
                        backgroundColors = ['#1cc88a', '#e74a3b', '#f6c23e', '#5a5c69', '#36b9cc'];
                    }
                    
                    new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: labels,
                            datasets: [{
                                data: data,
                                backgroundColor: backgroundColors,
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'right',
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const label = context.label || '';
                                            const value = context.raw || 0;
                                            return `${label}: ${value}%`;
                                        }
                                    }
                                }
                            }
                        }
                    });
                });
            </script>
        </div>
            
    {% elif section == 'achievements' %}
        <div class="container">
            <nav class="navbar navbar-expand-lg navbar-light bg-light mb-4">
                <a class="navbar-brand" href="{{ url_for('dashboard') }}">Back to Dashboard</a>
                <div class="navbar-nav">
                    <a class="nav-link" href="{{ url_for('live_market') }}">Live Market</a>
                    <a class="nav-link" href="{{ url_for('portfolio') }}">Portfolio</a>
                    <a class="nav-link" href="{{ url_for('watchlist') }}">Watchlist</a>
                    <a class="nav-link" href="{{ url_for('alerts') }}">Price Alerts</a>
                    <a class="nav-link" href="{{ url_for('risk_quiz') }}">Risk Quiz</a>
                    <a class="nav-link" href="{{ url_for('logout') }}">Logout</a>
                </div>
            </nav>
            <h2>Achievements</h2>
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
            <h3>Add Achievement</h3>
            <form method="POST" action="{{ url_for('update_achievements') }}">
                <div class="input-group mb-3">
                    <input type="text" class="form-control" name="achievement" placeholder="Achievement name" required>
                    <button type="submit" class="btn btn-primary">Add</button>
                </div>
            </form>
            <ul class="list-group">
                {% if achievements %}
                    {% for achievement in achievements %}
                        <li class="list-group-item">{{ achievement }}</li>
                    {% endfor %}
                {% endif %}
            </ul>
        </div>
    {% endif %}

    <script>
        // Toggle password visibility
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const icon = event.target;
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        // Password strength checker
        function checkPasswordStrength(password) {
            const strengthBar = document.getElementById('passwordStrengthBar');
            let strength = 0;

            if (!strengthBar) return;

            // Check password length
            if (password.length >= 8) strength++;
            if (password.length >= 12) strength++;

            // Check for different character types
            if (/[a-z]/.test(password)) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^a-zA-Z0-9]/.test(password)) strength++;

            // Remove all classes
            strengthBar.className = 'password-strength-bar';

            // Apply strength class
            if (strength <= 2) {
                strengthBar.classList.add('weak');
            } else if (strength <= 4) {
                strengthBar.classList.add('medium');
            } else {
                strengthBar.classList.add('strong');
            }
        }

        // Auto-dismiss alerts after 5 seconds
        document.addEventListener('DOMContentLoaded', function() {
            const alerts = document.querySelectorAll('.alert:not(.alert-info)');
            alerts.forEach(alert => {
                setTimeout(() => {
                    const bsAlert = new bootstrap.Alert(alert);
                    bsAlert.close();
                }, 5000);
            });

            // Format verification code input
            const codeInput = document.getElementById('code');
            if (codeInput) {
                codeInput.addEventListener('input', function(e) {
                    this.value = this.value.toUpperCase();
                });
            }
        });
    </script>
</body>
</html>